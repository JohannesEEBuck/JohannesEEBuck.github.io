function BCC(t,e,a,n){this.navList=n,this.clocks={},this.dataset=t,this.dataSetInfo=initDataSetInfo(this.dataset),this.range=this.getInitialRange(this.dataSetInfo);var i=this.dataset.DataSet.Data[0].Country["@attributes"].code,r=this.getCountrySeriesData(i);$(".on_script_load").show(),$(".on_loading").hide(),"undefined"==typeof SVGRect?(this.navList.maxClock=2,this.chart=initJqChart(e,this,this.dataset,this.dataSetInfo,this.dataset,this.dataSetInfo,2)):this.chart=new C3Chart("#"+e,this,r,this.dataSetInfo[i].label,this.getRegions(i),{height:200},this.range.clock.min.date.setDate(30),this.range.clock.max.date.setDate(30)),this.chartPos=this.range.chart.max.pos-1,this.timer=new TimerLoop(this.onTimerPosChanged.bind(this),a,this.range.clock.min.pos,this.range.clock.max.pos,!0,!1,!0),this.timeSlider=this.initTimeSlider(),this.initMonthRangeSelectors(this.range),$(document.body).localize(),this.cycleClockHelp=new CycleClockHelp("#pie")}function getQuarterBeginDate(t,e,a){var n=toDate(t,e,a);n.setDate(1),n.setMonth(3*Math.floor(n.getMonth()/3));var i=new Date(0);return i.setFullYear(n.getFullYear()),i.setMonth(n.getMonth()),i.setDate(n.getDate()),i}function getQuarterEndDate(t,e,a){var n=toDate(t,e,a);n.setMonth(3*Math.floor(n.getMonth()/3)+2),n.setMonth(n.getMonth()+1),n.setDate(0);var i=new Date(0);return i.setFullYear(n.getFullYear()),i.setMonth(n.getMonth()),i.setDate(n.getDate()),i}function haveTP(t,e){for(var a=0;a<t.length;a++)if(t[a].tp===e)return!0;return!1}function getTP(t,e){for(var a=0;a<t.length;a++)if(t[a].tp===e)return t[a]}"function"==typeof define&&define.amd?define("bcc",["jquery","c3Chart","i18nextBCC","timer","cycleClock","jquery-ui","datepicker-de","datepicker-fr","monthPicker","bcc_commons","bcc_ui"],function(t){return BCC}):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=BCC),BCC.prototype.initMonthRangeSelectors=function(t){this.monthRangeSelector=new MonthRangeSelector("#range_selector","#from_month_picker","#to_month_picker",t),this.genMonthRangeSelector=new MonthRangeSelector("#genRange_select","#genFrom_month_picker","#genTo_month_picker",t),$("#genClockTimeSelect_month_picker").val($.datepicker.formatDate("mm/yy",t.clock.max.date)),$("#genClockTimeSelect_month_picker").MonthPicker({ShowIcon:!1,UseInputMask:!0,StartYear:t.clock.max.date.getFullYear(),MaxMonth:t.clock.max.date,MinMonth:t.clock.min.date,i18n:$.datepicker.regional[$.i18n.language.substr(0,2)]}),$("#genRange_select").change(function(t){updateGenClockTimeSelect()}),$("#genFrom_month_picker").change(function(t){updateGenClockTimeSelect()}),$("#genTo_month_picker").change(function(t){updateGenClockTimeSelect()})},BCC.prototype.onTimerPosChanged=function(t,e){var a=t,n=this.getChartPos(t);return(n>this.range.chart.max.pos&&a>e.maxTimerPos||a<0)&&(a=e.backward?e.maxTimerPos:0),n!=this.chartPos&&n<=this.range.chart.max.pos&&n>=0&&(this.chart.selectPointAllSeries(n),this.chartPos=n),a<=e.maxTimerPos&&(this.updateClocks(a,this.navList.retrieveCountriesShown()),this.timeSlider.slider("value",a),this.updateAsideStats(this.navList.retrieveCountryShownCodes(),a)),a},BCC.prototype.selectCountry=function(t){this.navList.selectCountry(t),this.chart.loadCountryRegions(t,!1,!0),this.chart.focusCountry(t),this.updateAsideStats(this.navList.retrieveCountryShownCodes())},BCC.prototype.getChartPos=function(t){void 0===t&&(t=this.timer.timerPos);var e=t/3;return e>0?Math.floor(e):Math.ceil(e)},BCC.prototype.getInitialRange=function(t){var e={chart:this.getInitialChartRange(t),clock:this.getInitialClocktRange(t)};return{chart:this.getInitialChartRange(t),clock:this.getInitialClocktRange(t),initial:e}},BCC.prototype.cycleClockOptions={width:210,height:220,radius:80,fontSize:16,innerDist:15,crise1Color:"#FAA61A",crise1MirrorColor:"#FEDEB3",crise2Color:"#F26522",crise2MirrorColor:"#F89F6C",noCriseColor:"#8BD1D1",noCriseMirrorColor:"#3BBFBD"},BCC.prototype.switchCountryForSelector=function(t){var e=$(t);if(e.length>0){var a=e.attr("data-country-ongraph"),n=e[0].value;if(a!==n){this.chart.loadCountry(n,this.navList.getClockIndex(t)),this.chart.unloadCountry(a,!1),e.attr("data-country-ongraph",n);var i=e.parents(".country[data-country-code]");i.attr("data-country-code",n),this.selectCountry(n),this.clocks[n]=new CycleClock(i.find(".oneClock"),this.cycleClockOptions),this.updateClockForCountry(n),this.navList.updateSelectorsList(),this.chart.reDraw()}}},BCC.prototype.removeCountry=function(t){var e=$(t).parents(".country[data-country-code]"),a=e.attr("data-country-code"),n=e.hasClass("selected");if(this.chart.unloadCountry(a),this.clocks[a]=void 0,this.navList.removeCountryInNavlist(a),this.navList.updateSelectorsList(),n){this.chart.clearRegions(!0),this.getCountryCodes(),1==this.navList.getShownCountries().length?this.updateAsideStats(this.navList.retrieveCountryShownCodes()):this.updateAsideStats();var i=this.navList.retrieveCountryShownCodes();this.selectCountry(i[i.length-1])}else 1==this.navList.getShownCountries().length&&this.updateAsideStats(this.navList.retrieveCountryShownCodes());this.chart.reDraw()},BCC.prototype.updateClockForCountry=function(t){var e=this.navList.getClockForCountry(t);this.updateClocks(bcc.timer.timerPos,e)},BCC.prototype.updateRangeDate=function(t,e,a,n,i){var r=toDate(t,n,i),o=toDate(e,n,i);a&&r<this.range.initial.clock.min.date&&(r=this.range.initial.clock.min.date),a&&e>this.range.initial.clock.max.date&&(o=this.range.initial.clock.max.date);for(var s=0;s<this.dataSetInfo[this.range.clock.refCountry].date.length;s++){var h=toDate(this.dataSetInfo[this.range.clock.refCountry].date[s]);if(h.getTime()>=o.getTime()){this.range.clock.max.date=h,this.range.clock.max.pos=s;break}}for(var s=this.dataSetInfo[this.range.clock.refCountry].date.length-1;s>=0;s--){var h=toDate(this.dataSetInfo[this.range.clock.refCountry].date[s]);if(h.getTime()<=r.getTime()){this.range.clock.min.date=h,this.range.clock.min.pos=s;break}}return this.afterClockRangeUpdated(),this.range},BCC.prototype.afterClockRangeUpdated=function(){this.updateChartRange(this.dataSetInfo,this.range),this.chart.setRange(this.range.chart.min.date,this.range.chart.max.date),this.timeSlider.slider("option",{min:this.range.clock.min.pos,max:this.range.clock.max.pos}),this.timer.minTimerPos=this.range.clock.min.pos,this.timer.maxTimerPos=this.range.clock.max.pos,(this.timer.timerPos>this.range.clock.max.pos||this.timer.timerPos<this.range.clock.min.pos)&&this.timer.setPos(this.range.clock.min.pos)},BCC.prototype.updateChartRange=function(t,e){for(var a=1;a<t[e.chart.refCountry].dates.length;a++){var n=toDate(t[e.chart.refCountry].dates[a],"dd/mm/yyyy","/");if(new Date(n).setDate(1)>=new Date(e.clock.min.date).setDate(1)){e.chart.min.pos=a-1,e.chart.min.date=new Date(new Date(e.clock.min.date).setDate(31));break}}for(var a=t[e.chart.refCountry].dates.length-1;a>0;a--){var n=toDate(t[e.chart.refCountry].dates[a],"dd/mm/yyyy","/");if(new Date(n).setDate(1)<=new Date(e.clock.max.date).setDate(1)){e.chart.max.pos=a-1,e.chart.max.date=new Date(new Date(e.clock.max.date).setDate(31));break}}},BCC.prototype.getInitialChartRange=function(t){var e={min:{date:0,pos:0},max:{date:0,pos:0},refCountry:"EA"};return void 0!==t&&t&&$.each(t,function(t,a){a.dates.length-2>e.max.pos&&(e.max.pos=a.dates.length-2,e.max.date=toDate(a.dates[e.max.pos+1],"dd/mm/yyyy","/"),e.min.pos=0,e.min.date=toDate(a.dates[1],"dd/mm/yyyy","/"),e.refCountry=t)}.bind(this)),e},BCC.prototype.getInitialClocktRange=function(t){var e={min:{date:0,pos:0},max:{date:0,pos:0},refCountry:"EA"};return void 0!==t&&t&&$.each(t,function(t,a){if(a.date.length-1>e.max.pos){for(var n=a.date.length-1;n>0&&(!a.angle[n]||isNaN(a.angle[n]));n--);e.max.pos=n,e.max.date=toDate(a.date[e.max.pos],"dd/mm/yyyy","/"),e.min.pos=0,e.min.date=toDate(a.date[0],"dd/mm/yyyy","/"),e.refCountry=t}}.bind(this)),e},BCC.prototype.initTimeSlider=function(t){var e=this.dataset.DataSet.Data[0].Country["@attributes"].code,a=this.dataSetInfo[e].date.length-1;return $("<div id='timeSlider'></div>").insertAfter("#countriesChart").slider({min:0,max:a,value:a,slide:function(t,e){this.timer.setPos(e.value)}.bind(this)}),$("#timeSlider")},BCC.prototype.updateClocks=function(t,e){void 0!==e&&e||(e=this.navList.retrieveCountriesShown()),e.each(function(e,a){var n=t,i=$(a).attr("data-country-code"),r=$(a).find(".oneClock>canvas"),o=void 0;if(r.length>0&&this.clocks[i]){var s=this.dataSetInfo[i];if(o||(o=s.date[t],$("#currentQuarter").html(formatQuarterHtml(o))),s&&s.angle&&n<=s.angle.length){var h=NaN;if(!s.gdpgc||Math.floor(n/3)>s.gdpgc.length||isNaN(s.angle[n]))for(var d=t;d>0;d--)if(!isNaN(s.angle[d])&&isFinite(s.angle[d])){n=d;break}h=s.angle[n],this.clocks[i].updateClock(h)}if(s&&s.date&&n<=s.date.length){var c=s.date[n];$(a).find("span#currentDate, span.currentDate").html($.datepicker.formatDate("MM yy",toDate(c),$.datepicker.regional[$.i18n.language.substr(0,2)]))}}}.bind(this))},BCC.prototype.getCountryCodes=function(){var t=[];for(var e in this.dataSetInfo)t.push(e);return t},BCC.prototype.getCountrySeriesData=function(t){var e=[];return e.push(this.dataSetInfo[t].dates),e.push(this.dataSetInfo[t].ser2),e},BCC.prototype.addCountry=function(t,e){if(this.dataSetInfo[t]){this.chart.loadCountry(t,this.navList.getNewClockIndex()),this.chart.selectPointAllSeries(this.getChartPos(this.timer.timerPos));var a=this.navList.addCountryInNavlist(t,function(t){this.switchCountryForSelector(t.target)}.bind(this),function(t){this.mouseEnteredCountry(t.target)}.bind(this),function(t){this.mouseLeavedCountry(t.target)}.bind(this),function(t){this.clickedCountry(t.target)}.bind(this),function(t){this.removeCountry(t.target)}.bind(this),void 0,e);this.selectCountry(t),this.chart.reDraw(),this.clocks[t]=new CycleClock($(a).find(".oneClock"),this.cycleClockOptions),this.updateClockForCountry(t)}this.navList.updateSelectorsList()},BCC.prototype.mouseEnteredCountry=function(t){var e=$(t).parents(".country[data-country-code]").attr("data-country-code");this.chart.focusCountry(e)},BCC.prototype.mouseLeavedCountry=function(t){bcc.chart.unfocusCountry();var e=this.navList.getSelectedCountry();e?bcc.chart.focusCountry(e):bcc.chart.clearRegions(!0)},BCC.prototype.clickedCountry=function(t){var e=$(t).parents(".country[data-country-code]").attr("data-country-code");bcc.selectCountry(e)},BCC.prototype.findPreviousTP=function(t,e,a){var n=[],i=void 0;if(this.dataSetInfo[t].tps.length>0)for(var r=0;r<this.dataSetInfo[t].tps.length;r++)this.dataSetInfo[t].tps[r].date.getTime()<e.getTime()&&(void 0===i||this.dataSetInfo[t].tps[r].date.getTime()>i[0].date.getTime()?(void 0===i&&(i=[]),n=i,i=[],i.push(this.dataSetInfo[t].tps[r])):void 0!==i&&this.dataSetInfo[t].tps[r].date.getTime()!==i[0].date.getTime()||(void 0===i&&(i=[]),n=i,i.push(this.dataSetInfo[t].tps[r])));return a?n:i},BCC.prototype.findPreviousABCD_TP=function(t,e,a){var n=[],i=void 0;if(this.dataSetInfo[t].tps.length>0)for(var r=0;r<this.dataSetInfo[t].tps.length;r++)this.dataSetInfo[t].tps[r].date.getTime()<e.getTime()&&"α"!=this.dataSetInfo[t].tps[r].tp&&"β"!=this.dataSetInfo[t].tps[r].tp&&(void 0===i||this.dataSetInfo[t].tps[r].date.getTime()>i[0].date.getTime()?(void 0===i&&(i=[]),n=i,i=[],i.push(this.dataSetInfo[t].tps[r])):void 0!==i&&this.dataSetInfo[t].tps[r].date.getTime()!==i[0].date.getTime()||(void 0===i&&(i=[]),n=i,i.push(this.dataSetInfo[t].tps[r])));return a?n:i},BCC.prototype.updateAsideStats=function(t,e){e||(e=this.timer.timerPos);var a="<div>",n=this.navList.getSelectedCountry();if(n){if(t)for(var i=0;i<t.length;i++)if(n==t[i]){var r=toDate(this.dataSetInfo[t[i]].date[e],"dd/mm/yyyy","/"),o=getQuarterEndDate(r);o.getTime()>toDate(this.dataSetInfo[t[i]].dates[this.dataSetInfo[t[i]].dates.length-1],"dd/mm/yyyy","/").getTime()&&(o=toDate(this.dataSetInfo[t[i]].dates[this.dataSetInfo[t[i]].dates.length-1],"dd/mm/yyyy","/"));for(var s,h=this.dataSetInfo[t[i]].gdp.length-1;h>=0&&!s;){if(this.dataSetInfo[t[i]].gdp[h]&&this.dataSetInfo[t[i]].gdp[h]>0){o.getTime(),getQuarterEndDate(toDate(this.dataSetInfo[t[i]].dates[h+1],"dd/mm/yyyy","/")),getQuarterEndDate(toDate(this.dataSetInfo[t[i]].dates[h+1],"dd/mm/yyyy","/")).getTime();o.getTime()>getQuarterEndDate(toDate(this.dataSetInfo[t[i]].dates[h+1],"dd/mm/yyyy","/")).getTime()&&(s=h,o=getQuarterEndDate(toDate(this.dataSetInfo[t[i]].dates[h+1],"dd/mm/yyyy","/")))}h--}var d=this.findPreviousTP(t[i],o);if(d&&o.getTime()){a+='<span data-i18n="for">'+$.i18n.t("for")+"</span>: "+this.dataSetInfo[t[i]].description;var c;if(haveTP(d,"D"))c=Math.floor(monthDiff(getQuarterEndDate(getTP(d,"D").date),o)/3)+1,a+='<br/><span data-i18n="expansion">'+$.i18n.t("expansion")+"</span>: "+c+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>";else if(haveTP(d,"C"))c=Math.floor(monthDiff(getQuarterEndDate(getTP(d,"C").date),o)/3)+1,a+='<br/><span data-i18n="recovery">'+$.i18n.t("recovery")+"</span>: "+c+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>";else if(haveTP(d,"β")){c=Math.floor(monthDiff(getQuarterEndDate(getTP(d,"β").date),o)/3)+1;var l=this.findPreviousTP(t[i],o,!0);l&&haveTP(l,"B")&&(a+='<br/><span data-i18n="recession">'+$.i18n.t("recession")+"</span>: "+Math.floor(monthDiff(getQuarterEndDate(getTP(l,"B").date),o)/3)+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>")}else haveTP(d,"B")?(c=Math.floor(monthDiff(getQuarterEndDate(getTP(d,"B").date),o)/3)+1,a+='<br/><span data-i18n="recession">'+$.i18n.t("recession")+"</span>: "+c+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>"):haveTP(d,"A")?(c=Math.floor(monthDiff(getQuarterEndDate(getTP(d,"A").date),o)/3)+1,a+='<br/><span data-i18n="slowdown">'+$.i18n.t("slowdown")+"</span>: "+c+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>"):haveTP(d,"α")&&(c=Math.floor(monthDiff(getQuarterEndDate(getTP(d,"α").date),o)/3)+1,a+='<br/><span data-i18n="deceleration">'+$.i18n.t("deceleration")+"</span>: "+c+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>");d=this.findPreviousABCD_TP(t[i],o)}}$("#docClock").html(a+"</div>"),$("#docClock").toggleClass("animate"),setTimeout(function(){$("#docClock").toggleClass("animate")},600)}},BCC.prototype.updateAsideStatsOld=function(t,e){var a='<div><h1 data-i18n="current_cycle_durations">'+$.i18n.t("current_cycle_durations")+"</h1><br/><b>"+("GB"==t?"UK":"GR"==t?"EL":t)+"</b>";if(t){e||(e=this.timer.timerPos);for(var n=toDate(this.dataSetInfo[t].date[e],"dd/mm/yyyy","/"),i=this.getRegions(t),r=!1,o=0;o<i.length;o++){var s=toDate(i[o].start,"dd/mm/yyyy","/");s.setDate(0);var h=toDate(i[o].end,"dd/mm/yyyy","/");if(h.setMonth(3*Math.floor(h.getMonth()/3)+2),n.getTime()>=s.getTime()&&n.getTime()<=h.getTime()){var d=monthDiff(s,h);"crise2"==i[o].class?(a+='<br/><span data-i18n="recession">'+$.i18n.t("recession")+"</span> = "+Math.floor(d/3)+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>",r=!0):"crise1"==i[o].class&&(a+='<br/><span data-i18n="slowdown">'+$.i18n.t("slowdown")+"</span> = "+Math.floor(d/3)+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>",r=!0)}else(!s||isNaN(s.getTime()))&&!isNaN(h.getTime())&&n.getTime()<=h.getTime()?"crise2"==i[o].class?(a+='<br/><span data-i18n="recession">'+$.i18n.t("recession")+'</span> <span data-i18n="until">'+$.i18n.t("until")+"</span> "+formatQuarterHtml(h),r=!0):"crise1"==i[o].class&&(a+='<br/><span data-i18n="slowdown">'+$.i18n.t("slowdown")+'</span> <span data-i18n="until">'+$.i18n.t("until")+"</span> "+formatQuarterHtml(h),r=!0):(!h||isNaN(h.getTime()))&&!isNaN(s.getTime())&&n.getTime()>=s.getTime()&&("crise2"==i[o].class?(a+='<br/><span data-i18n="recession">'+$.i18n.t("recession")+'</span> <span data-i18n="since">'+$.i18n.t("since")+"</span> "+formatQuarterHtml(s),r=!0):"crise1"==i[o].class&&(a+='<br/><span data-i18n="slowdown">'+$.i18n.t("slowdown")+'</span> <span data-i18n="since">'+$.i18n.t("since")+"</span> "+formatQuarterHtml(s),r=!0))}if(!r){var c=this.findGrowthDuration(n,i);if(c.startDate&&c.stopDate){var d=monthDiff(c.startDate,c.stopDate);a+='<br/><span data-i18n="growth">'+$.i18n.t("growth")+"</span> = "+Math.floor(d/3)+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>"}else!c.startDate&&c.stopDate?a+='<br/><span data-i18n="growth">'+$.i18n.t("growth")+'</span> <span data-i18n="until">'+$.i18n.t("until")+"</span> "+formatQuarterHtml(c.stopDate):!c.stopDate&&c.startDate&&(a+='<br/><span data-i18n="growth">'+$.i18n.t("growth")+'</span> <span data-i18n="since">'+$.i18n.t("since")+"</span> "+formatQuarterHtml(c.startDate))}}a.length>0&&$("#docClock").html(a+"</div>")},BCC.prototype.findGrowthDuration=function(t,e){for(var a,n,i=0;i<e.length;i++){var r=toDate(e[i].start,"dd/mm/yyyy","/"),o=toDate(e[i].end,"dd/mm/yyyy","/");r&&!isNaN(r.getTime())&&r.getTime()>t.getTime()&&(!n||r.getTime()<n.getTime())&&(n=r),o&&!isNaN(o.getTime())&&o.getTime()<t.getTime()&&(!a||o.getTime()>a.getTime())&&(a=o)}return{startDate:a,stopDate:n}};var regionsByCountry=[];BCC.prototype.getRegions=function(t){if(regionsByCountry[t])return regionsByCountry[t];for(var e=this.dataSetInfo[t],a=[],n=!1,i=!1,r=!1,o=!1,s="",h="",d="",c="",l=0;l<e.region.length;l++)"A"==e.region[l][0]&&(s=e.region[l][1],n=!0),"B"==e.region[l][0]&&(h=e.region[l][1],i=!0),"C"==e.region[l][0]&&(d=e.region[l][1],r=!0),"D"==e.region[l][0]&&(c=e.region[l][1],o=!0),r&&(i?(a.push({start:h,end:d,class:"crise2"}),i=r=!1):(a.push({end:d,class:"crise2"}),r=!1)),o&&(n?(a.unshift({start:s,end:c,class:"crise1"}),o=n=!1):(a.unshift({end:c,class:"crise1"}),o=!1));return"B"==e.region[e.region.length-1][0]?(a.push({start:e.region[e.region.length-1][1],class:"crise2"}),"A"==e.region[e.region.length-2][0]&&a.unshift({start:e.region[e.region.length-2][1],class:"crise1"})):"A"==e.region[e.region.length-1][0]&&(a.unshift({start:e.region[e.region.length-1][1],class:"crise1"}),"B"==e.region[e.region.length-2][0]&&a.push({start:e.region[e.region.length-2][1],class:"crise2"})),regionsByCountry[t]=a,a};