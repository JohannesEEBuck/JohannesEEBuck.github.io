function BCC(t,e,a,n){this.navList=n,this.clocks={},this.dataset=t,this.dataSetInfo=initDataSetInfo(this.dataset),this.range=this.getInitialRange(this.dataSetInfo);var i=this.dataset.DataSet.Data[0].Country["@attributes"].code,o=this.getCountrySeriesData(i);$(".on_script_load").show(),$(".on_loading").hide(),"undefined"==typeof SVGRect?(this.navList.maxClock=2,this.chart=initJqChart(e,this,this.dataset,this.dataSetInfo,this.dataset,this.dataSetInfo,2)):this.chart=new C3Chart("#"+e,this,o,this.dataSetInfo[i].label,this.getRegions(i),{height:200},this.range.clock.min.date.setDate(30),this.range.clock.max.date.setDate(30)),this.chartPos=this.range.chart.max.pos-1,this.timer=new TimerLoop(this.onTimerPosChanged.bind(this),a,this.range.clock.min.pos,this.range.clock.max.pos,!0,!1,!0),this.timeSlider=this.initTimeSlider(),this.initMonthRangeSelectors(this.range),$(document.body).localize(),this.cycleClockHelp=new CycleClockHelp("#pie")}function getQuarterBeginDate(t,e,a){var n=toDate(t,e,a);n.setDate(1),n.setMonth(3*Math.floor(n.getMonth()/3));var i=new Date(0);return i.setFullYear(n.getFullYear()),i.setMonth(n.getMonth()),i.setDate(n.getDate()),i}function getQuarterEndDate(t,e,a){var n=toDate(t,e,a);n.setMonth(3*Math.floor(n.getMonth()/3)+2),n.setMonth(n.getMonth()+1),n.setDate(0);var i=new Date(0);return i.setFullYear(n.getFullYear()),i.setMonth(n.getMonth()),i.setDate(n.getDate()),i}function haveTP(t,e){for(var a=0;a<t.length;a++)if(t[a].tp===e)return!0;return!1}function getTP(t,e){for(var a=0;a<t.length;a++)if(t[a].tp===e)return t[a]}"function"==typeof define&&define.amd?define("bcc",["jquery","c3Chart","i18nextBCC","timer","cycleClock","jquery-ui","datepicker-de","datepicker-fr","monthPicker","bcc_commons","bcc_ui"],function(t){return BCC}):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=BCC),BCC.prototype.initMonthRangeSelectors=function(t){this.monthRangeSelector=new MonthRangeSelector("#range_selector","#from_month_picker","#to_month_picker",t),this.genMonthRangeSelector=new MonthRangeSelector("#genRange_select","#genFrom_month_picker","#genTo_month_picker",t),$("#genClockTimeSelect_month_picker").val($.datepicker.formatDate("mm/yy",t.clock.max.date)),$("#genClockTimeSelect_month_picker").MonthPicker({ShowIcon:!1,UseInputMask:!0,StartYear:t.clock.max.date.getFullYear(),MaxMonth:t.clock.max.date,MinMonth:t.clock.min.date,i18n:$.datepicker.regional[$.i18n.language.substr(0,2)]}),$("#genRange_select").change(function(t){updateGenClockTimeSelect()}),$("#genFrom_month_picker").change(function(t){updateGenClockTimeSelect()}),$("#genTo_month_picker").change(function(t){updateGenClockTimeSelect()})},BCC.prototype.onTimerPosChanged=function(t,e){var a=t,n=this.getChartPos(t);return(n>this.range.chart.max.pos&&a>e.maxTimerPos||a<0)&&(a=e.backward?e.maxTimerPos:0),n!=this.chartPos&&n<=this.range.chart.max.pos&&n>=0&&(this.chart.selectPointAllSeries(n),this.chartPos=n),a<=e.maxTimerPos&&(this.updateClocks(a,this.navList.retrieveCountriesShown()),this.timeSlider.slider("value",a),this.updateAsideStats(this.navList.retrieveCountryShownCodes(),a)),a},BCC.prototype.selectCountry=function(t){this.navList.selectCountry(t),this.chart.loadCountryRegions(t,!1,!0),this.chart.focusCountry(t),this.updateAsideStats(this.navList.retrieveCountryShownCodes())},BCC.prototype.getChartPos=function(t){void 0===t&&(t=this.timer.timerPos);var e=t/3;return e>0?Math.floor(e):Math.ceil(e)},BCC.prototype.getInitialRange=function(t){var e={chart:this.getInitialChartRange(t),clock:this.getInitialClocktRange(t)};return{chart:this.getInitialChartRange(t),clock:this.getInitialClocktRange(t),initial:e}},BCC.prototype.cycleClockOptions={width:210,height:220,radius:80,fontSize:16,innerDist:15,crise1Color:"#FAA61A",crise1MirrorColor:"#FEDEB3",crise2Color:"#F26522",crise2MirrorColor:"#F89F6C",noCriseColor:"#8BD1D1",noCriseMirrorColor:"#3BBFBD"},BCC.prototype.switchCountryForSelector=function(t){var e=$(t);if(e.length>0){var a=e.attr("data-country-ongraph"),n=e[0].value;if(a!==n){this.chart.loadCountry(n,this.navList.getClockIndex(t)),this.chart.unloadCountry(a,!1),e.attr("data-country-ongraph",n);var i=e.parents(".country[data-country-code]");i.attr("data-country-code",n),this.selectCountry(n),this.clocks[n]=new CycleClock(i.find(".oneClock"),this.cycleClockOptions),this.updateClockForCountry(n),this.navList.updateSelectorsList(),this.chart.reDraw()}}},BCC.prototype.removeCountry=function(t){var e=$(t).parents(".country[data-country-code]"),a=e.attr("data-country-code"),n=e.hasClass("selected");if(this.chart.unloadCountry(a),this.clocks[a]=void 0,this.navList.removeCountryInNavlist(a),this.navList.updateSelectorsList(),n){this.chart.clearRegions(!0),this.getCountryCodes(),1==this.navList.getShownCountries().length?this.updateAsideStats(this.navList.retrieveCountryShownCodes()):this.updateAsideStats();var i=this.navList.retrieveCountryShownCodes();this.selectCountry(i[i.length-1])}else 1==this.navList.getShownCountries().length&&this.updateAsideStats(this.navList.retrieveCountryShownCodes());this.chart.reDraw()},BCC.prototype.updateClockForCountry=function(t){var e=this.navList.getClockForCountry(t);this.updateClocks(bcc.timer.timerPos,e)},BCC.prototype.updateRangeDate=function(t,e,a,n,i){var o=toDate(t,n,i),r=toDate(e,n,i);a&&o<this.range.initial.clock.min.date&&(o=this.range.initial.clock.min.date),a&&e>this.range.initial.clock.max.date&&(r=this.range.initial.clock.max.date);for(var s=0;s<this.dataSetInfo[this.range.clock.refCountry].date.length;s++){var c=toDate(this.dataSetInfo[this.range.clock.refCountry].date[s]);if(c.getTime()>=r.getTime()){this.range.clock.max.date=c,this.range.clock.max.pos=s;break}}for(var s=this.dataSetInfo[this.range.clock.refCountry].date.length-1;s>=0;s--){var c=toDate(this.dataSetInfo[this.range.clock.refCountry].date[s]);if(c.getTime()<=o.getTime()){this.range.clock.min.date=c,this.range.clock.min.pos=s;break}}return this.afterClockRangeUpdated(),this.range},BCC.prototype.afterClockRangeUpdated=function(){this.updateChartRange(this.dataSetInfo,this.range),this.chart.setRange(this.range.chart.min.date,this.range.chart.max.date),this.timeSlider.slider("option",{min:this.range.clock.min.pos,max:this.range.clock.max.pos}),this.timer.minTimerPos=this.range.clock.min.pos,this.timer.maxTimerPos=this.range.clock.max.pos,(this.timer.timerPos>this.range.clock.max.pos||this.timer.timerPos<this.range.clock.min.pos)&&this.timer.setPos(this.range.clock.min.pos)},BCC.prototype.updateChartRange=function(t,e){for(var a=1;a<t[e.chart.refCountry].dates.length;a++){var n=toDate(t[e.chart.refCountry].dates[a],"dd/mm/yyyy","/");if(new Date(n).setDate(1)>=new Date(e.clock.min.date).setDate(1)){e.chart.min.pos=a-1,e.chart.min.date=new Date(new Date(e.clock.min.date).setDate(31));break}}for(var a=t[e.chart.refCountry].dates.length-1;a>0;a--){var n=toDate(t[e.chart.refCountry].dates[a],"dd/mm/yyyy","/");if(new Date(n).setDate(1)<=new Date(e.clock.max.date).setDate(1)){e.chart.max.pos=a-1,e.chart.max.date=new Date(new Date(e.clock.max.date).setDate(31));break}}},BCC.prototype.getInitialChartRange=function(t){var e={min:{date:0,pos:0},max:{date:0,pos:0},refCountry:"EA"};return void 0!==t&&t&&$.each(t,function(t,a){a.dates.length-2>e.max.pos&&(e.max.pos=a.dates.length-2,e.max.date=toDate(a.dates[e.max.pos+1],"dd/mm/yyyy","/"),e.min.pos=0,e.min.date=toDate(a.dates[1],"dd/mm/yyyy","/"),e.refCountry=t)}.bind(this)),e},BCC.prototype.getInitialClocktRange=function(t){var e={min:{date:0,pos:0},max:{date:0,pos:0},refCountry:"EA"};return void 0!==t&&t&&$.each(t,function(t,a){if(a.date.length-1>e.max.pos){for(var n=a.date.length-1;n>0&&(!a.angle[n]||isNaN(a.angle[n]));n--);e.max.pos=n,e.max.date=toDate(a.date[e.max.pos],"dd/mm/yyyy","/"),e.min.pos=0,e.min.date=toDate(a.date[0],"dd/mm/yyyy","/"),e.refCountry=t}}.bind(this)),e},BCC.prototype.initTimeSlider=function(t){var e=this.dataset.DataSet.Data[0].Country["@attributes"].code,a=this.dataSetInfo[e].date.length-1;return $("<div id='timeSlider'></div>").insertAfter("#countriesChart").slider({min:0,max:a,value:a,slide:function(t,e){this.timer.setPos(e.value)}.bind(this)}),$("#timeSlider")},BCC.prototype.updateClocks=function(t,e){void 0!==e&&e||(e=this.navList.retrieveCountriesShown()),e.each(function(e,a){var n=t,i=$(a).attr("data-country-code"),o=$(a).find(".oneClock>canvas"),r=void 0;if(o.length>0&&this.clocks[i]){var s=this.dataSetInfo[i];if(r||(r=s.date[t],$("#currentQuarter").html(formatQuarterHtml(r))),s&&s.angle&&n<=s.angle.length){var c=NaN;if(!s.gdpgc||Math.floor(n/3)>s.gdpgc.length||isNaN(s.angle[n]))for(var h=t;h>0;h--)if(!isNaN(s.angle[h])&&isFinite(s.angle[h])){n=h;break}c=s.angle[n],this.clocks[i].updateClock(c)}if(s&&s.date&&n<=s.date.length){var d=s.date[n];$(a).find("span#currentDate, span.currentDate").html($.datepicker.formatDate("MM yy",toDate(d),$.datepicker.regional[$.i18n.language.substr(0,2)]))}}}.bind(this))},BCC.prototype.getCountryCodes=function(){var t=[];for(var e in this.dataSetInfo)t.push(e);return t},BCC.prototype.getCountrySeriesData=function(t){var e=[];return e.push(this.dataSetInfo[t].dates),e.push(this.dataSetInfo[t].ser2),e},BCC.prototype.addCountry=function(t,e){if(this.dataSetInfo[t]){this.chart.loadCountry(t,this.navList.getNewClockIndex()),this.chart.selectPointAllSeries(this.getChartPos(this.timer.timerPos));var a=this.navList.addCountryInNavlist(t,function(t){this.switchCountryForSelector(t.target)}.bind(this),function(t){this.mouseEnteredCountry(t.target)}.bind(this),function(t){this.mouseLeavedCountry(t.target)}.bind(this),function(t){this.clickedCountry(t.target)}.bind(this),function(t){this.removeCountry(t.target)}.bind(this),void 0,e);this.selectCountry(t),this.chart.reDraw(),this.clocks[t]=new CycleClock($(a).find(".oneClock"),this.cycleClockOptions),this.updateClockForCountry(t)}this.navList.updateSelectorsList()},BCC.prototype.mouseEnteredCountry=function(t){var e=$(t).parents(".country[data-country-code]").attr("data-country-code");this.chart.focusCountry(e)},BCC.prototype.mouseLeavedCountry=function(t){bcc.chart.unfocusCountry();var e=this.navList.getSelectedCountry();e?bcc.chart.focusCountry(e):bcc.chart.clearRegions(!0)},BCC.prototype.clickedCountry=function(t){var e=$(t).parents(".country[data-country-code]").attr("data-country-code");bcc.selectCountry(e)},BCC.prototype.findPreviousTP=function(t,e,a){var n=[],i=void 0;if(this.dataSetInfo[t].tps.length>0)for(var o=0;o<this.dataSetInfo[t].tps.length;o++)this.dataSetInfo[t].tps[o].date.getTime()<e.getTime()&&(void 0===i||this.dataSetInfo[t].tps[o].date.getTime()>i[0].date.getTime()?(void 0===i&&(i=[]),n=i,i=[],i.push(this.dataSetInfo[t].tps[o])):void 0!==i&&this.dataSetInfo[t].tps[o].date.getTime()!==i[0].date.getTime()||(void 0===i&&(i=[]),n=i,i.push(this.dataSetInfo[t].tps[o])));return a?n:i},BCC.prototype.findPreviousABCD_TP=function(t,e,a){var n=[],i=void 0;if(this.dataSetInfo[t].tps.length>0)for(var o=0;o<this.dataSetInfo[t].tps.length;o++)this.dataSetInfo[t].tps[o].date.getTime()<e.getTime()&&"α"!=this.dataSetInfo[t].tps[o].tp&&"β"!=this.dataSetInfo[t].tps[o].tp&&(void 0===i||this.dataSetInfo[t].tps[o].date.getTime()>i[0].date.getTime()?(void 0===i&&(i=[]),n=i,i=[],i.push(this.dataSetInfo[t].tps[o])):void 0!==i&&this.dataSetInfo[t].tps[o].date.getTime()!==i[0].date.getTime()||(void 0===i&&(i=[]),n=i,i.push(this.dataSetInfo[t].tps[o])));return a?n:i},BCC.prototype.updateAsideStats=function(t,e){e||(e=this.timer.timerPos);var a="<div>",n=this.navList.getSelectedCountry();if(n){if(t)for(var i=0;i<t.length;i++)if(n==t[i]){var o=toDate(this.dataSetInfo[t[i]].date[e],"dd/mm/yyyy","/"),r=getQuarterEndDate(o);r.getTime()>toDate(this.dataSetInfo[t[i]].dates[this.dataSetInfo[t[i]].dates.length-1],"dd/mm/yyyy","/").getTime()&&(r=toDate(this.dataSetInfo[t[i]].dates[this.dataSetInfo[t[i]].dates.length-1],"dd/mm/yyyy","/"));for(var s,c=this.dataSetInfo[t[i]].gdp.length-1;c>=0&&!s;){if(this.dataSetInfo[t[i]].gdp[c]&&this.dataSetInfo[t[i]].gdp[c]>0){r.getTime(),getQuarterEndDate(toDate(this.dataSetInfo[t[i]].dates[c+1],"dd/mm/yyyy","/")),getQuarterEndDate(toDate(this.dataSetInfo[t[i]].dates[c+1],"dd/mm/yyyy","/")).getTime();r.getTime()>getQuarterEndDate(toDate(this.dataSetInfo[t[i]].dates[c+1],"dd/mm/yyyy","/")).getTime()&&(s=c,r=getQuarterEndDate(toDate(this.dataSetInfo[t[i]].dates[c+1],"dd/mm/yyyy","/")))}c--}var h=this.findPreviousTP(t[i],r);h&&r.getTime()&&(a+='<span data-i18n="for">'+$.i18n.t("for")+'</span>: <span data-i18n="country:'+t[i]+'">'+$.i18n.t(t[i],{ns:"country"})+"</span>",h=this.findPreviousABCD_TP(t[i],r))}$("#docClock").html(a+"</div>"),$("#docClock").toggleClass("animate"),setTimeout(function(){$("#docClock").toggleClass("animate")},600)}},BCC.prototype.updateAsideStatsOld=function(t,e){var a='<div><h1 data-i18n="current_cycle_durations">'+$.i18n.t("current_cycle_durations")+"</h1><br/><b>"+("GB"==t?"UK":"GR"==t?"EL":t)+"</b>";if(t){e||(e=this.timer.timerPos);for(var n=toDate(this.dataSetInfo[t].date[e],"dd/mm/yyyy","/"),i=this.getRegions(t),o=!1,r=0;r<i.length;r++){var s=toDate(i[r].start,"dd/mm/yyyy","/");s.setDate(0);var c=toDate(i[r].end,"dd/mm/yyyy","/");if(c.setMonth(3*Math.floor(c.getMonth()/3)+2),n.getTime()>=s.getTime()&&n.getTime()<=c.getTime()){var h=monthDiff(s,c);"crise2"==i[r].class?(a+='<br/><span data-i18n="recession">'+$.i18n.t("recession")+"</span> = "+Math.floor(h/3)+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>",o=!0):"crise1"==i[r].class&&(a+='<br/><span data-i18n="slowdown">'+$.i18n.t("slowdown")+"</span> = "+Math.floor(h/3)+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>",o=!0)}else(!s||isNaN(s.getTime()))&&!isNaN(c.getTime())&&n.getTime()<=c.getTime()?"crise2"==i[r].class?(a+='<br/><span data-i18n="recession">'+$.i18n.t("recession")+'</span> <span data-i18n="until">'+$.i18n.t("until")+"</span> "+formatQuarterHtml(c),o=!0):"crise1"==i[r].class&&(a+='<br/><span data-i18n="slowdown">'+$.i18n.t("slowdown")+'</span> <span data-i18n="until">'+$.i18n.t("until")+"</span> "+formatQuarterHtml(c),o=!0):(!c||isNaN(c.getTime()))&&!isNaN(s.getTime())&&n.getTime()>=s.getTime()&&("crise2"==i[r].class?(a+='<br/><span data-i18n="recession">'+$.i18n.t("recession")+'</span> <span data-i18n="since">'+$.i18n.t("since")+"</span> "+formatQuarterHtml(s),o=!0):"crise1"==i[r].class&&(a+='<br/><span data-i18n="slowdown">'+$.i18n.t("slowdown")+'</span> <span data-i18n="since">'+$.i18n.t("since")+"</span> "+formatQuarterHtml(s),o=!0))}if(!o){var d=this.findGrowthDuration(n,i);if(d.startDate&&d.stopDate){var h=monthDiff(d.startDate,d.stopDate);a+='<br/><span data-i18n="growth">'+$.i18n.t("growth")+"</span> = "+Math.floor(h/3)+' <span data-i18n="quarters">'+$.i18n.t("quarters")+"</span>"}else!d.startDate&&d.stopDate?a+='<br/><span data-i18n="growth">'+$.i18n.t("growth")+'</span> <span data-i18n="until">'+$.i18n.t("until")+"</span> "+formatQuarterHtml(d.stopDate):!d.stopDate&&d.startDate&&(a+='<br/><span data-i18n="growth">'+$.i18n.t("growth")+'</span> <span data-i18n="since">'+$.i18n.t("since")+"</span> "+formatQuarterHtml(d.startDate))}}a.length>0&&$("#docClock").html(a+"</div>")},BCC.prototype.findGrowthDuration=function(t,e){for(var a,n,i=0;i<e.length;i++){var o=toDate(e[i].start,"dd/mm/yyyy","/"),r=toDate(e[i].end,"dd/mm/yyyy","/");o&&!isNaN(o.getTime())&&o.getTime()>t.getTime()&&(!n||o.getTime()<n.getTime())&&(n=o),r&&!isNaN(r.getTime())&&r.getTime()<t.getTime()&&(!a||r.getTime()>a.getTime())&&(a=r)}return{startDate:a,stopDate:n}};var regionsByCountry=[];BCC.prototype.getRegions=function(t){if(regionsByCountry[t])return regionsByCountry[t];for(var e=this.dataSetInfo[t],a=[],n=!1,i=!1,o=!1,r=!1,s="",c="",h="",d="",l=0;l<e.region.length;l++)"A"==e.region[l][0]&&(s=e.region[l][1],n=!0),"B"==e.region[l][0]&&(c=e.region[l][1],i=!0),"C"==e.region[l][0]&&(h=e.region[l][1],o=!0),"D"==e.region[l][0]&&(d=e.region[l][1],r=!0),o&&(i?(a.push({start:c,end:h,class:"crise2"}),i=o=!1):(a.push({end:h,class:"crise2"}),o=!1)),r&&(n?(a.unshift({start:s,end:d,class:"crise1"}),r=n=!1):(a.unshift({end:d,class:"crise1"}),r=!1));return"B"==e.region[e.region.length-1][0]?(a.push({start:e.region[e.region.length-1][1],class:"crise2"}),"A"==e.region[e.region.length-2][0]&&a.unshift({start:e.region[e.region.length-2][1],class:"crise1"})):"A"==e.region[e.region.length-1][0]&&(a.unshift({start:e.region[e.region.length-1][1],class:"crise1"}),"B"==e.region[e.region.length-2][0]&&a.push({start:e.region[e.region.length-2][1],class:"crise2"})),regionsByCountry[t]=a,a};