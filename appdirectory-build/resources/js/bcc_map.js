function BCCMapApp(t,e,o,i,a,n,r){var s=t.DataSet.Data[0].Country["@attributes"].code,c=e[s].date.length-1;if(isNaN(e[s].angle[c]))for(var h=c;h>0;h--)if(!isNaN(e[s].angle[h])){c=h;break}var p=e[s].date[0],l=e[s].date[c];this.selectedDate=l,this.bccmap=new BCCMap(o,e,this.selectedDate),this.initEAClock(n),this.bccMapControls=new BCCMapControls(this.bccmap,this.eaClock,i,a,r,e,l,p,"dd/mm/yyyy","/"),$.datepicker.setDefaults($.datepicker.regional[$.i18n.language.substr(0,2)]),$(document.body).localize()}function BCCMap(t,e,o,i,a){this.geojsonLayer=null,this.selectedDate=toDate(o,i,a),this.dataSetInfo=e,this.map=$(t),this.initLeaflet(t,"resources/map/CNTR_RG_10M_2014_CLIP_EU.geojson")}function isBccCoverage(t){return t&&t.CNTR_ID&&isEAMember(t)}function isEAMember(t){return t&&t.CNTR_ID&&$.inArray(t.CNTR_ID,"undefined"!=typeof eaMembers&&eaMembers?eaMembers:["BE","DE","IE","GR","EL","ES","FR","IT","CY","LU","MT","NL","AT","PT","SI","SK","FI","EE","LV","LT"])>=0}function isEUMember(t){return t&&t.EU_TERR&&"Y"==t.EU_TERR}function isEUCandidate(t){return t&&t.CC_TERR&&"Y"==t.CC_TERR}function isEFTAMember(t){return t&&t.EFTA_TERR&&"Y"==t.EFTA_TERR}function isEstatCoverage(t){return isEUMember(t)||isEFTAMember(t)||isEUCandidate(t)}function BCCMapControls(t,e,o,i,a,n,r,s,c,h){this.bccMap=t,this.eaClock=e,this.maxDate=toDate(r,c,h),this.minDate=toDate(s,c,h),this.monthPicker=$(o),this.currentMonthSelector=i,this.initTimer(a,n),this.initMonthPicker(),this.onDateChanged=function(t){$(this.currentMonthSelector).text($.datepicker.formatDate("M yy",t,$.datepicker.regional[$.i18n.language.substr(0,2)])),this.bccMap.setDate(t);var e=$.inArray("01/"+$.datepicker.formatDate("mm/yy",t),this.bccMap.dataSetInfo.EA.date);if(e>=0){var o=this.bccMap.dataSetInfo.EA.angle[e];this.eaClock.updateClock(o),this.bccMap.updateMapCountryClock()}this.timer.timerPos=e}.bind(this),this.eaClock.drawClock(),this.setDate(this.maxDate)}"function"==typeof define&&define.amd?define("bcc_map",["jquery","d3","leaflet","bcc_commons","cycleClock","timer","jquery-ui","datepicker-de","datepicker-fr","monthPicker"],function(t,e,o){return window.L=o,BCCMapApp}):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=BCCMapApp),BCCMapApp.prototype.initEAClock=function(t){this.eaClock=new CycleClock(t,{width:210,height:200,radius:70,crise1Color:"#FAA61A",crise1MirrorColor:"#FEDEB3",crise2Color:"#F26522",crise2MirrorColor:"#F89F6C",noCriseColor:"#8BD1D1",noCriseMirrorColor:"#3BBFBD"})},BCCMapApp.prototype.nextMonth=function(){this.bccMapControls.nextMonth()},BCCMapApp.prototype.prevMonth=function(){this.bccMapControls.prevMonth()},BCCMapApp.prototype.setDate=function(t){this.bccMapControls.setDate(t)},BCCMap.prototype.initLeaflet=function(t,e){var o=$(t).attr("id");this.leafletMap=L.map(o,{center:L.latLng(53.008939,12.389892),zoom:4.3,minZoom:4,maxZoom:10,maxBounds:[[34.274,-24.511],[71.746,45.099]],attributionControl:!1,zoomControl:!1}),L.control.zoom({position:"bottomleft"}).addTo(this.leafletMap);var i=L.control({position:"topleft"});i.onAdd=function(t){for(var e=L.DomUtil.create("div","info_legend"),o=["#3BBFBD","#8BD1D1","#FAA61A","#F26522","#F89F6C","#FEDEB3","#7F7F7F","#E5E5E5"],i=["solid 1px black","solid 1px black","solid 1px black","solid 1px black","solid 1px black","solid 1px black","solid 1px black","none"],a=["expansion","deceleration","slowdown","recession","recession2","recovery","no_data","out_BCC_coverage"],n=[$.i18n.t("expansion"),$.i18n.t("deceleration"),$.i18n.t("slowdown"),$.i18n.t("recession"),$.i18n.t("recession2"),$.i18n.t("recovery"),$.i18n.t("no_data"),$.i18n.t("out_BCC_coverage")],r=0;r<o.length;r++)e.innerHTML+='<div><i style="background:'+o[r]+"; border:"+i[r]+'"></i><span data-i18n="'+a[r]+'">'+n[r]+"</span></div>";return e},i.addTo(this.leafletMap),this.countryInfo=L.control({position:"topright"}),this.countryInfo.onAdd=function(t){return this.countryInfoDiv=L.DomUtil.create("div","country_info"),this.setCountryInfo(),this.countryInfoDiv}.bind(this),this.countryInfo.addTo(this.leafletMap),$.getJSON(e).done(function(t){this.geojsonLayer=L.geoJson(t,{style:this.styleFeature.bind(this),onEachFeature:this.initFeature.bind(this)}).addTo(this.leafletMap),this.reorderLayers()}.bind(this)).fail(function(){console.log("error")})},BCCMap.prototype.setCountryInfo=function(t){var e,o=!1;if(t&&(e=t.CNTR_ID,"UK"==e&&(e="GB"),"EL"==e&&(e="GR"),o=!!this.dataSetInfo[e]),this.countryInfoDiv){var i=isEUMember(t)?'<span data-i18n="eu_member">'+$.i18n.t("eu_member")+"</span>":isEFTAMember(t)&&isEUCandidate(t)?'<span data-i18n="efta_member">'+$.i18n.t("efta_member")+'</span data-i18n="eu_candidate"><br/><span>'+$.i18n.t("eu_candidate")+"</span>":isEFTAMember(t)?'<span data-i18n="efta_member">'+$.i18n.t("efta_member")+"</span>":isEUCandidate(t)?'<span data-i18n="eu_candidate">'+$.i18n.t("eu_candidate")+"<span>":'<span data-i18n="out_ES">'+$.i18n.t("out_ES")+"</span>";isEAMember(t)&&(i+='<br/><span data-i18n="ea_member">'+$.i18n.t("ea_member")+"</span>"),this.countryInfoDiv.innerHTML='<div id="map_countryClock" style="display:inline-block;"></div><div style="display:inline-block;vertical-align: top;">'+(t?'<b data-i18n="country:'+e+'">'+$.i18n.t("country:"+e)+'</b><br /><span class="ue_member">'+i+"</span>":'<span data-i18n="mouse_over_for_data">'+$.i18n.t("mouse_over_for_data")+"</span>")+"</div>"}t&&o&&($("#map_countryClock").attr("data-countryCode",e),$("#map_countryData").attr("data-countryCode",e),this.clock=new CycleClock("#map_countryClock",{width:105,height:105,radius:34,crise1Color:"#FAA61A",crise1MirrorColor:"#FEDEB3",crise2Color:"#F26522",crise2MirrorColor:"#F89F6C",noCriseColor:"#8BD1D1",noCriseMirrorColor:"#3BBFBD",fontSize:14,innerDist:8}),this.updateMapCountryClock())},BCCMap.prototype.updateMapCountryClock=function(){var t=$("#map_countryClock[data-countryCode]");if(this.clock&&t&&t.length>0){var e=t.attr("data-countryCode"),o=this.getAngleForCountryDate(e,this.selectedDate);isValidNumeric(o)?this.clock.updateClock(o):this.clock.drawClock()}},BCCMap.prototype.reorderLayers=function(){null!=this.geojsonLayer&&this.geojsonLayer.eachLayer(function(t){isBccCoverage(t.feature.properties)?t.bringToFront():isEUMember(t.feature.properties)||t.bringToBack()}.bind(this))},BCCMap.prototype.initFeature=function(t,e){e.on({mouseover:this.highlightFeature.bind(this),mouseout:this.resetHighlight.bind(this)})},BCCMap.prototype.resetHighlight=function(t){this.geojsonLayer.resetStyle(t.target),isBccCoverage(t.target.feature.properties)?t.target.bringToFront():t.target.bringToBack(),this.setCountryInfo()},BCCMap.prototype.highlightFeature=function(t){var e=t.target;e.setStyle({weight:1.5,color:"#000000",opacity:.9}),L.Browser.ie||L.Browser.opera||e.bringToFront(),this.setCountryInfo(e.feature.properties)},BCCMap.prototype.styleFeature=function(t){return this.getCountryStyle(t,this.selectedDate)},BCCMap.prototype.getCountryStyle=function(t,e,o,i){var a=t.properties.CNTR_ID.toUpperCase(),n=isBccCoverage(t.properties);"UK"==a?a="GB":"EL"==a&&(a="GR");var r=this.getAngleForCountryDate(a,e,o,i),s=this.getColorForAngle(r,n?"#7F7F7F":"#E5E5E5");return{fillColor:s,weight:1,opacity:n?.5:0,color:n?"#555555":s,fillOpacity:1}},BCCMap.prototype.getAngleForCountryDate=function(t,e,o,i){var e=toDate(e,o,i),a=0;if(this.dataSetInfo[t]){for(var n=0;n<this.dataSetInfo[t].date.length;n++){if(stringToDate(this.dataSetInfo[t].date[n],"dd/mm/yyyy","/").getTime()>=e.getTime()){a=n;break}}return this.dataSetInfo[t].angle[a]}},BCCMap.prototype.getDataForCountryDate=function(t,e,o,i){var e=toDate(e,o,i),a=0;if(this.dataSetInfo[t]){for(var n=0;n<this.dataSetInfo[t].date.length;n++){if(stringToDate(this.dataSetInfo[t].date[n],"dd/mm/yyyy","/").getTime()>=e.getTime()){a=n;break}}return{angle:this.dataSetInfo[t].angle[a],gdp:this.dataSetInfo[t].gdp[a/3],gdpgc:this.dataSetInfo[t].gdpgc[a/3]}}},BCCMap.prototype.getColorForAngle=function(t,e){for(var o=Number(t);o>2*Math.PI;)o-=2*Math.PI;for(;o<0;)o+=2*Math.PI;return o>=0&&o<=Math.PI/2?"#8BD1D1":o>Math.PI/2&&o<=3*Math.PI/4?"#FAA61A":o>3*Math.PI/4&&o<=Math.PI?"#F26522":o>Math.PI&&o<=5*Math.PI/4?"#F89F6C":o>5*Math.PI/4&&o<=3*Math.PI/2?"#FEDEB3":o>3*Math.PI/2&&o<=2*Math.PI?"#3BBFBD":e},BCCMap.prototype.setDate=function(t,e,o){this.selectedDate=toDate(t,e,o),null!=this.geojsonLayer&&this.geojsonLayer.eachLayer(function(t){t.setStyle(this.styleFeature(t.feature))}.bind(this))},BCCMapControls.prototype.initTimer=function(t,e){this.timer=new TimerLoop(this.setPos.bind(this),t,0,getMaxClockIndex(e),!0,!1,!0)},BCCMapControls.prototype.initMonthPicker=function(){this.monthPicker.MonthPicker({SelectedMonth:this.maxDate,MonthFormat:"mm/yy",MaxMonth:this.maxDate,MinMonth:this.minDate,OnAfterChooseMonth:function(t){this.setDate(t)}.bind(this),i18n:$.datepicker.regional[$.i18n.language.substr(0,2)]})},BCCMapControls.prototype.updateRange=function(t,e,o,i,a,n){this.minDate=toDate(o,a,n),this.maxDate=toDate(i,a,n),this.timer.maxTimerPos=e,this.timer.minTimerPos=t,this.monthPicker.MonthPicker("Destroy"),this.initMonthPicker(),this.selectedDate.getTime()<this.minDate.getTime()?this.setDate(this.minDate):this.selectedDate.getTime()>this.maxDate.getTime()?this.setDate(this.maxDate):this.monthPicker.MonthPicker("SetSelectedMonth",this.selectedDate)},BCCMapControls.prototype.setDate=function(t,e,o){this.selectedDate=toDate(t,e,o),this.onDateChanged(this.selectedDate),this.monthPicker.MonthPicker("SetSelectedMonth",t)},BCCMapControls.prototype.setPos=function(t){var e=toDate(this.minDate);e.setMonth(e.getMonth()+(t-this.timer.minTimerPos)),this.setDate(e)},BCCMapControls.prototype.nextMonth=function(){var t=toDate(this.selectedDate);t.setMonth(t.getMonth()+1),t.getTime()<=this.maxDate.getTime()&&t.getTime()>=this.minDate.getTime()&&(this.monthPicker.val($.datepicker.formatDate("mm/yy",t,$.datepicker.regional[$.i18n.language.substr(0,2)])),this.setDate(t))},BCCMapControls.prototype.prevMonth=function(){var t=toDate(this.selectedDate);t.setMonth(t.getMonth()-1),t.getTime()<=this.maxDate.getTime()&&t.getTime()>=this.minDate.getTime()&&(this.monthPicker.val($.datepicker.formatDate("mm/yy",t,$.datepicker.regional[$.i18n.language.substr(0,2)])),this.setDate(t))};