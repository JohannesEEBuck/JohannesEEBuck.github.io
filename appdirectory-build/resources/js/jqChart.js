function JqChart(t,e,s,i,o,a,r,n){if(this.bcc=e,this.dataSetInfo=s,("undefined"===a||!a||a<=0)&&(a=o.length),void 0!==$.jqplot){this.cursorTooltipData=null,this.cursorLine=null,this.countryInSeries=[],this.countries=i,this.id=t,this.series=o,this.yMin=0,this.yMax=0,this.xMin=0,this.xMax=0;for(var l=0,h=0,d=0,c=0,p=[],u=0;u<a&&u<o.length;u++)p.push({label:this.countries[u]+"_GDP_GC",show:0===u,showLabel:0===u});for(var u=0;u<this.series.length;u++)for(var v=0;v<this.series[u].length;v++)this.series[u][v].length>1&&(this.series[u][v][1]>h&&(h=this.series[u][v][1]),this.series[u][v][1]<l&&(l=this.series[u][v][1]),this.series[u][v][0]>c&&(c=this.series[u][v][0]),this.series[u][v][0]<d&&(d=this.series[u][v][0]));this.yMin=Number(l.toFixed(2))-.01,this.yMax=Number(h.toFixed(2))+.01,this.xMin=Number(d.toFixed(2))-.01,this.xMax=Number(c.toFixed(2))+.01,r&&r.getTime()>this.xMin&&(this.xMin=r.getTime()),n&&n.getTime()<this.xMax&&(this.xMax=n.getTime()),$.jqplot.config.enablePlugins=!0,this.countryInSeries.push(this.countries[0]);for(var f=[],u=0;u<a&&u<o.length;u++)f.push(this.series[u]);this.jqPlots=$.jqplot(this.id,f,{seriesDefaults:{lineWidth:.5,markerRenderer:$.jqplot.MarkerRenderer,markerOptions:{size:5},selection:{show:!0,selectedMarkerOptions:{size:25,shadow:!0,style:"circle"},onSelect:function(t,e,s,i){return!1},onDeselect:function(t,e,s,i){return!1}}},series:p,axes:{xaxis:{min:this.xMin,max:this.xMax,renderer:$.jqplot.DateAxisRenderer,tickOptions:{formatString:"%b&nbsp;%#d",showGridline:!1},tickInterval:"3 month",rendererOptions:{tickRenderer:$.jqplot.AxisTickRenderer,tickOptions:{showLabel:!0,size:5,markSize:10,formatter:function(t,e){var s=new Date(e);return s&&s.getMonth()>=0&&s.getMonth()<3&&s.getYear()%2==0?$.datepicker.formatDate("mm-yy",s):""}}}},yaxis:{min:this.yMin,max:this.yMax,tickOptions:{formatString:"%.2f",showGridline:!1}}},highlighter:{show:!0,showTooltip:!1,sizeAdjust:4},legend:{renderer:$.jqplot.EnhancedLegendRenderer,show:!0,rendererOptions:{numberRows:1,seriesToggle:!1},location:"s",placement:"outsideGrid"},grid:{background:"#FFFFFF",shadow:!1,drawBorder:!1,gridLineColor:"#000000"},canvasOverlay:{show:!0,objects:[]},cursor:{show:!0,showTooltip:!0,tooltipLocation:"e",tooltipOffset:26,followMouse:!0,style:"e-resize"}}),$("#"+t).bind("jqplotMouseMove",onMouseMove),$("#"+t).bind("jqplotMouseLeave",onMouseLeave),this.loadCountryRegions(this.countries[0],!1,!0)}}function initJqChart(t,e,s,i,o,a,r){for(var n=[],l=[],h=0;h<s.DataSet.Data.length;h++){var d=s.DataSet.Data[h].Country["@attributes"].code;n.push(i[d].serie),l.push(d)}return new JqChart(t,e,i,l,n,o,a,r)}function onMouseMove(t,e,s,i,o){var a,r;if(o.series.length>0){for(var n=0;n<o.series[0].data.length;n++)o.series[0].data[n].length>0&&(o.series[0].data[n][0]<s.xaxis&&(!a||o.series[0].data[n][0]>a)&&(a=o.series[0].data[n][0]),o.series[0].data[n][0]>s.xaxis&&(!r||o.series[0].data[n][0]<r)&&(r=o.series[0].data[n][0]));var l=s.xaxis-a<r-s.xaxis?a:r;if(l!=this.cursorLine||!this.cursorTooltipData){this.cursorLine=l;for(var h="",n=0;n<o.series.length;n++)if(o.series[n].show){for(var d,c=o.series[n].label,p=o.series[n].color,u=0;u<o.series[n].data.length;u++)o.series[n].data[u].length>1&&o.series[n].data[u][0]==l&&(d=o.series[n].data[u][1]);h=h+'\t<tr class="tooltip-name-'+c+'">\t\t<td class="name">\t\t\t<span style="background-color:'+p+'"/>'+c+'</td>\t\t<td class="value">'+d+"</td>\t</tr>"}this.cursorTooltipData=h}$("#"+chart.id+" .jqplot-cursor-tooltip").html('<table class="tooltip"><tbody>\t<tr>\t\t<th colspan="2">'+$.datepicker.formatDate("dd/mm/yy",new Date(l))+"</th>\t</tr>"+this.cursorTooltipData+"</tbody></table>")}}function onMouseLeave(t,e,s,i,o){chart.cursorLine=null,chart.cursorTooltipData=null,chart.removeOverlayByName("cursorLine",!0)}JqChart.prototype.setRange=function(t,e){},JqChart.prototype.focusCountry=function(t){},JqChart.prototype.unfocusCountry=function(t){},JqChart.prototype.loadCountry=function(t,e,s){if(void 0!==$.jqplot&&(index=$.inArray(t,this.countries),index>=0&&e>=0)){var i=this.isShownCountry(t),o=!1===i||i===e,a=this.jqPlots.series[e].label;this.jqPlots.data[e]=this.series[index],this.jqPlots.series[e].data=this.series[index],this.jqPlots.series[e].label=t+"_GDP_GC",this.jqPlots.options.series[e].label=t+"_GDP_GC",this.jqPlots.series[e].show=o,this.jqPlots.series[e].showLabel=o,this.jqPlots.options.series[e].show=o,this.jqPlots.options.series[e].showLabel=o,this.showCountryWithLabel(a),this.loadCountryRegions(t,!1,s),s&&this.jqPlots.drawSeries({},e)}},JqChart.prototype.unloadCountry=function(t,e){if(void 0!==$.jqplot){var s=$.inArray(t,this.countryInSeries);s>=0&&(this.countryInSeries=this.countryInSeries.splice(s,1),this.jqPlots.data=this.jqPlots.data.splice(s,1),this.jqPlots.options.series=this.jqPlots.options.series.splice(s,1),e&&this.jqPlots.drawSeries({}))}},JqChart.prototype.loadCountryLines=function(t,e){if(void 0!==$.jqplot){for(var s=this.dataSetInfo[t].label,i=0;i<s.length;i++)this.setVerticalLine(toDate(s[i].value).getTime(),null,s[i].text);e&&this.drawCanvasOverlay()}},JqChart.prototype.setVerticalLine=function(t,e,s,i){if(void 0!==$.jqplot){(e?this.jqPlots.plugins.canvasOverlay.getObject(e):null)?this.jqPlots.plugins.canvasOverlay.getObject(e).options.x=t:this.jqPlots.plugins.canvasOverlay.addVerticalLine({name:e,x:t,lineWidth:1,color:"rgba(80, 80, 80,0.5)",shadow:!1,showLabel:void 0!==s&&s,label:s,labelLocation:"s",labelAnchor:"end",labelOffset:10,labelOffsetX:-8,labelOffsetY:15}),i&&this.drawCanvasOverlay()}},JqChart.prototype.loadCountryRegions=function(t,e,s){if(void 0!==$.jqplot){this.clearRegions();for(var i=bcc.getRegions(t),o=[],a=0;a<i.length;a++){var r=i[a];if(r.start&&r.end){var n=r.start?toDate(r.start):this.xMin,l=r.end?toDate(r.end):this.xMax;"crise2"==r.class?o.push({color:"#C7E0F1",start:new Date(n.getTime()),end:new Date(l.getTime())}):this.addRegion(n,l,"#DCE9F5")}}for(var a=0;a<o.length;a++)this.addRegion(o[a].start,o[a].end,o[a].color);e||this.loadCountryLines(t),s&&this.drawCanvasOverlay()}},JqChart.prototype.addRegion=function(t,e,s,i,o){void 0!==$.jqplot&&(this.jqPlots.plugins.canvasOverlay.addRectangle({xmin:t,xmax:e,xminOffset:"0px",xmaxOffset:"0px",yminOffset:"2px",ymaxOffset:"2px",color:s,shadow:!1,showTooltip:!1,name:i}),o&&this.drawCanvasOverlay())},JqChart.prototype.clearRegions=function(t){void 0!==$.jqplot&&this.cleanOverlay(t)},JqChart.prototype.cleanOverlay=function(t){void 0!==$.jqplot&&(this.jqPlots.plugins.canvasOverlay.clear(this.jqPlots),this.jqPlots.plugins.canvasOverlay.objects=[],this.jqPlots.plugins.canvasOverlay.objectNames=[],t&&this.drawCanvasOverlay())},JqChart.prototype.selectPointAllSeries=function(t){if(void 0!==$.jqplot){for(var e=!1,s=0;s<this.jqPlots.series.length;s++)this.jqPlots.series[s].selection.selectedPoints=[],this.jqPlots.series[s].data.length>t&&(this.jqPlots.togglePoint(s,t,!0),e=!0);return e}},JqChart.prototype.selectPoint=function(t,e,s){void 0!==$.jqplot&&this.selectPointAllSeries(e)},JqChart.prototype.isShownCountry=function(t){if(void 0!==$.jqplot){for(var e=0;e<this.jqPlots.series.length;e++)if(this.jqPlots.series[e].show&&this.jqPlots.series[e].label==t+"_GDP_GC")return e;return!1}},JqChart.prototype.showCountryWithLabel=function(t){if(void 0!==$.jqplot)for(var e=0;e<this.jqPlots.series.length;e++)if(!this.jqPlots.series[e].show&&this.jqPlots.series[e].label==t)return this.jqPlots.series[e].show=!0,e},JqChart.prototype.reDraw=function(t){void 0!==$.jqplot&&this.jqPlots.redraw(t)},JqChart.prototype.removeOverlayByName=function(t,e){void 0!==$.jqplot&&(this.jqPlots.plugins.canvasOverlay.removeObject(t),e&&this.drawCanvasOverlay())},JqChart.prototype.drawCanvasOverlay=function(){void 0!==$.jqplot&&($(".jqplot-canvasOverlay-label").remove(),this.jqPlots.plugins.canvasOverlay.draw(this.jqPlots))},JqChart.prototype.drawSeries=function(){void 0!==$.jqplot&&this.jqPlots.drawSeries({})},JqChart.prototype.getSingleCanvas=function(t){if(void 0!==$.jqplot){var e=$("#"+this.id+" canvas.jqplot-grid-canvas"),s=$("#"+this.id+" canvas.jqplot-overlayCanvas-canvas"),i=$("#"+this.id+" canvas.jqplot-series-canvas"),o=$("#"+this.id+" canvas.jqplot-base-canvas"),a=document.createElement("canvas");a.height=o.attr("height"),a.width=o.attr("width");var r=a.getContext("2d");t&&(r.fillStyle=t,r.fillRect(0,0,a.width,a.height)),r.fillStyle="#000000",r.drawImage(e[0],0,0);var n=s.css("top").replace(/[^\d.-]/g,""),l=s.css("left").replace(/[^\d.-]/g,"");r.drawImage(s[0],l,n);for(var h=0;h<i.length;h++)r.drawImage(i[h],l,n);return this.addXTickLabelsOnCanvas(r,parseInt(n)+s.height()+20,0),this.addYTickLabelsOnCanvas(r,0,9),this.addCanvasOverlayLabels(r,5,-5),a}},JqChart.prototype.addCanvasOverlayLabels=function(t,e,s){for(var i=$("#"+this.id+" .jqplot-canvasOverlay-label"),o=0;o<i.length;o++){var a=$(i[o]),r=a.text(),n=a[0].offsetLeft+a[0].offsetWidth/2,l=a[0].offsetTop;t.save(),t.textAlign="right",t.translate(n,l),t.rotate(-Math.PI/2),t.fillText(r,-s,e),t.restore()}},JqChart.prototype.addXTickLabelsOnCanvas=function(t,e,s){for(var i=0;i<this.jqPlots.axes.xaxis._ticks.length;i++){var o=this.jqPlots.axes.xaxis._ticks[i];if(o.label&&o.label.length>0){var a=o._elem[0].offsetLeft;t.fillText(o.label,a+s,e)}}},JqChart.prototype.addYTickLabelsOnCanvas=function(t,e,s){for(var i=0;i<this.jqPlots.axes.yaxis._ticks.length;i++){var o=this.jqPlots.axes.yaxis._ticks[i];if(o.label&&o.label.length>0){var a=o._elem[0].offsetTop;t.fillText(o.label,e,a+s)}}},"function"==typeof define&&define.amd?define("jqChart",["jquery","jqplot-with-modules"],function(t,e){return JqChart}):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=JqChart);