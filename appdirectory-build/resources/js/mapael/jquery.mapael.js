/**
*
* Jquery Mapael - Dynamic maps jQuery plugin (based on raphael.js)
* Requires jQuery and raphael.js
*
* Version: 1.1.0
*
* Copyright (c) 2015 Vincent Brout√© (http://www.vincentbroute.fr/mapael)
* Licensed under the MIT license (http://www.opensource.org/licenses/mit-license.php).
*
*/

!function(e){"use strict";e.fn.mapael=function(t){t=e.extend(!0,{},e.fn.mapael.defaultOptions,t);for(var a in t.legend)if(e.isArray(t.legend[a]))for(var i=0;i<t.legend[a].length;++i)t.legend[a][i]=e.extend(!0,{},e.fn.mapael.legendDefaultOptions[a],t.legend[a][i]);else t.legend[a]=e.extend(!0,{},e.fn.mapael.legendDefaultOptions[a],t.legend[a]);return this.each(function(){var a=e(this),i=e("."+t.map.cssClass,this).empty(),n=e("<div>").addClass(t.map.tooltip.cssClass).css("display","none").appendTo(t.map.tooltip.target||i),o=e.fn.mapael.maps[t.map.name],l=new Raphael(i[0],o.width,o.height),m={},r=0,s={},p={},d={},h=[],f=0,c=0,g=0,u=0;t.map.tooltip.css&&n.css(t.map.tooltip.css),l.setViewBox(0,0,o.width,o.height,!1);for(f in o.elems)m=e.fn.mapael.getElemOptions(t.map.defaultArea,t.areas[f]?t.areas[f]:{},t.legend.area),s[f]={mapElem:l.path(o.elems[f]).attr(m.attrs)};t.map.beforeInit&&t.map.beforeInit(a,l,t);for(f in o.elems)m=e.fn.mapael.getElemOptions(t.map.defaultArea,t.areas[f]?t.areas[f]:{},t.legend.area),e.fn.mapael.initElem(l,s[f],m,n,f);d=e.fn.mapael.drawLinksCollection(l,t,t.links,o.getCoords,n);for(f in t.plots)p[f]=e.fn.mapael.drawPlot(f,t,o,l,n);if(a.on("zoom",function(n,m){var r=Math.min(Math.max(m.level,0),t.map.zoom.maxLevel),s=0,p=0,d=1+a.data("zoomLevel")*t.map.zoom.step,h=1+r*t.map.zoom.step,f=0,c=0,g={};void 0!==m.latitude&&void 0!==m.longitude&&(g=o.getCoords(m.latitude,m.longitude),m.x=g.x,m.y=g.y),void 0===m.x&&(m.x=l._viewBox[0]+l._viewBox[2]/2),void 0===m.y&&(m.y=l._viewBox[1]+l._viewBox[3]/2),0==r?(s=0,p=0):void 0!==m.fixedCenter&&1==m.fixedCenter?(f=a.data("panX")+(m.x-a.data("panX"))*(h-d)/h,c=a.data("panY")+(m.y-a.data("panY"))*(h-d)/h,s=Math.min(Math.max(0,f),o.width-o.width/h),p=Math.min(Math.max(0,c),o.height-o.height/h)):(s=Math.min(Math.max(0,m.x-o.width/h/2),o.width-o.width/h),p=Math.min(Math.max(0,m.y-o.height/h/2),o.height-o.height/h)),h==d&&s==a.data("panX")&&p==a.data("panY")||(t.map.zoom.animDuration>0?e.fn.mapael.animateViewBox(i,l,s,p,o.width/h,o.height/h,t.map.zoom.animDuration,t.map.zoom.animEasing):(l.setViewBox(s,p,o.width/h,o.height/h),clearTimeout(e.fn.mapael.zoomTO),e.fn.mapael.zoomTO=setTimeout(function(){i.trigger("afterZoom",{x1:s,y1:p,x2:s+o.width/h,y2:p+o.height/h})},150)),a.data({zoomLevel:r,panX:s,panY:p,zoomX:m.x,zoomY:m.y}))}),t.map.zoom.enabled&&t.map.zoom.mousewheel&&a.on("mousewheel",function(n){var o=i.offset(),l=t.map.width?e.fn.mapael.maps[t.map.name].width/t.map.width:e.fn.mapael.maps[t.map.name].width/i.width(),m=n.deltaY>0?1:-1,r=1/(1+a.data("zoomLevel")*t.map.zoom.step),s=r*l*(n.clientX+e(window).scrollLeft()-o.left)+a.data("panX"),p=r*l*(n.clientY+e(window).scrollTop()-o.top)+a.data("panY");return a.trigger("zoom",{fixedCenter:!0,level:a.data("zoomLevel")+m,x:s,y:p}),!1}),t.map.zoom.enabled&&t.map.zoom.touch&&a.on("touchstart",function(e){2===e.originalEvent.touches.length&&(c=(e.originalEvent.touches[0].clientX+e.originalEvent.touches[1].clientX)/2,g=(e.originalEvent.touches[0].clientY+e.originalEvent.touches[1].clientY)/2,u=Math.sqrt(Math.pow(e.originalEvent.touches[1].clientX-e.originalEvent.touches[0].clientX,2)+Math.pow(e.originalEvent.touches[1].clientY-e.originalEvent.touches[0].clientY,2)))}),t.map.zoom.enabled&&t.map.zoom.touch&&a.on("touchmove",function(n){var o=0,l=0,m=0,r=0,s=0,p=0,d=0;if(2===n.originalEvent.touches.length)return p=Math.sqrt(Math.pow(n.originalEvent.touches[1].clientX-n.originalEvent.touches[0].clientX,2)+Math.pow(n.originalEvent.touches[1].clientY-n.originalEvent.touches[0].clientY,2)),Math.abs(p-u)>15&&(o=i.offset(),l=t.map.width?e.fn.mapael.maps[t.map.name].width/t.map.width:e.fn.mapael.maps[t.map.name].width/i.width(),m=1/(1+a.data("zoomLevel")*t.map.zoom.step),r=m*l*(c+e(window).scrollLeft()-o.left)+a.data("panX"),s=m*l*(g+e(window).scrollTop()-o.top)+a.data("panY"),d=(p-u)/Math.abs(p-u),a.trigger("zoom",{fixedCenter:!0,level:a.data("zoomLevel")+d,x:r,y:s}),u=p),!1}),t.map.zoom.enabled&&e.fn.mapael.initZoom(i,l,o.width,o.height,t.map.zoom),void 0!==t.map.zoom.init&&a.trigger("zoom",t.map.zoom.init),e.merge(h,e.fn.mapael.createLegends(a,t,"area",s,1)),a.on("update",function(i,m,r,f,c){var g=0,u=0,v=0,x={};if(h.forEach(function(t){t.forEach&&t.forEach(function(t){void 0!==t.hidden&&1==t.hidden&&e(t.node).trigger("click")})}),void 0!==c&&(c.resetAreas&&(t.areas={}),c.resetPlots&&(t.plots={}),c.resetLinks&&(t.links={}),c.animDuration&&(v=c.animDuration)),e.extend(!0,t,m),"object"==typeof f)for(;g<f.length;g++)void 0!==p[f[g]]&&(v>0?function(e){e.mapElem.animate({opacity:0},v,"linear",function(){e.mapElem.remove()}),e.textElem&&e.textElem.animate({opacity:0},v,"linear",function(){e.textElem.remove()})}(p[f[g]]):(p[f[g]].mapElem.remove(),p[f[g]].textElem&&p[f[g]].textElem.remove()),delete p[f[g]]);if(void 0!==c&&"object"==typeof c.deletedLinks)for(g=0;g<c.deletedLinks.length;g++)void 0!==d[c.deletedLinks[g]]&&(v>0?function(e){e.mapElem.animate({opacity:0},v,"linear",function(){e.mapElem.remove()}),e.textElem&&e.textElem.animate({opacity:0},v,"linear",function(){e.textElem.remove()})}(d[c.deletedLinks[g]]):(d[c.deletedLinks[g]].mapElem.remove(),d[c.deletedLinks[g]].textElem&&d[c.deletedLinks[g]].textElem.remove()),delete d[c.deletedLinks[g]]);if("object"==typeof r)for(u in r)void 0===p[u]&&(t.plots[u]=r[u],p[u]=e.fn.mapael.drawPlot(u,t,o,l,n),v>0&&(p[u].mapElem.attr({opacity:0}),p[u].mapElem.animate({opacity:void 0!==p[u].mapElem.originalAttrs.opacity?p[u].mapElem.originalAttrs.opacity:1},v),p[u].textElem&&(p[u].textElem.attr({opacity:0}),p[u].textElem.animate({opacity:void 0!==p[u].textElem.originalAttrs.opacity?p[u].textElem.originalAttrs.opacity:1},v))));if(void 0!==c&&"object"==typeof c.newLinks){var E=e.fn.mapael.drawLinksCollection(l,t,c.newLinks,o.getCoords,n);if(e.extend(d),v>0)for(u in E)E[u].mapElem.attr({opacity:0}),E[u].mapElem.animate({opacity:void 0!==E[u].mapElem.originalAttrs.opacity?E[u].mapElem.originalAttrs.opacity:1},v),E[u].textElem&&(E[u].textElem.attr({opacity:0}),E[u].textElem.animate({opacity:void 0!==E[u].textElem.originalAttrs.opacity?E[u].textElem.originalAttrs.opacity:1},v))}for(u in s)x=e.fn.mapael.getElemOptions(t.map.defaultArea,t.areas[u]?t.areas[u]:{},t.legend.area),e.fn.mapael.updateElem(x,s[u],n,v);for(u in p)x=e.fn.mapael.getElemOptions(t.map.defaultPlot,t.plots[u]?t.plots[u]:{},t.legend.plot),"square"==x.type?(x.attrs.width=x.size,x.attrs.height=x.size,x.attrs.x=p[u].mapElem.attrs.x-(x.size-p[u].mapElem.attrs.width)/2,x.attrs.y=p[u].mapElem.attrs.y-(x.size-p[u].mapElem.attrs.height)/2):"image"==x.type?(x.attrs.width=x.width,x.attrs.height=x.height,x.attrs.x=p[u].mapElem.attrs.x-(x.width-p[u].mapElem.attrs.width)/2,x.attrs.y=p[u].mapElem.attrs.y-(x.height-p[u].mapElem.attrs.height)/2):x.attrs.r=x.size/2,e.fn.mapael.updateElem(x,p[u],n,v);for(u in d)x=e.fn.mapael.getElemOptions(t.map.defaultLink,t.links[u]?t.links[u]:{},{}),e.fn.mapael.updateElem(x,d[u],n,v);void 0!==c&&c.afterUpdate&&c.afterUpdate(a,l,s,p,t)}),t.map.width)l.setSize(t.map.width,o.height*(t.map.width/o.width)),e.merge(h,e.fn.mapael.createLegends(a,t,"plot",p,t.map.width/o.width));else{e(window).on("resize",function(){clearTimeout(r),r=setTimeout(function(){i.trigger("resizeEnd")},150)});var v=function(){e.merge(h,e.fn.mapael.createLegends(a,t,"plot",p,i.width()/o.width)),i.unbind("resizeEnd",v)};i.on("resizeEnd",function(){var e=i.width();l.width!=e&&l.setSize(e,o.height*(e/o.width))}).on("resizeEnd",v).trigger("resizeEnd")}t.map.afterInit&&t.map.afterInit(a,l,s,p,t),e(l.desc).append(" and Mapael (http://www.vincentbroute.fr/mapael/)")})},e.fn.mapael.zoomTO=0,e.fn.mapael.initElem=function(t,a,i,n,o){var l={},m={};void 0!==i.value&&(a.value=i.value),e.fn.mapael.setHoverOptions(a.mapElem,i.attrs,i.attrsHover),i.text&&void 0!==i.text.content?(l=a.mapElem.getBBox(),m=e.fn.mapael.getTextPosition(l,i.text.position,i.text.margin),i.text.attrs["text-anchor"]=m.textAnchor,a.textElem=t.text(m.x,m.y,i.text.content).attr(i.text.attrs),e.fn.mapael.setHoverOptions(a.textElem,i.text.attrs,i.text.attrsHover),i.eventHandlers&&e.fn.mapael.setEventHandlers(o,i,a.mapElem,a.textElem),e.fn.mapael.setHover(t,a.mapElem,a.textElem),e(a.textElem.node).attr("data-id",o)):(i.eventHandlers&&e.fn.mapael.setEventHandlers(o,i,a.mapElem),e.fn.mapael.setHover(t,a.mapElem)),i.tooltip&&(a.mapElem.tooltip=i.tooltip,e.fn.mapael.setTooltip(a.mapElem,n),i.text&&void 0!==i.text.content&&(a.textElem.tooltip=i.tooltip,e.fn.mapael.setTooltip(a.textElem,n))),i.href&&(a.mapElem.href=i.href,a.mapElem.target=i.target,e.fn.mapael.setHref(a.mapElem),i.text&&void 0!==i.text.content&&(a.textElem.href=i.href,a.textElem.target=i.target,e.fn.mapael.setHref(a.textElem))),e(a.mapElem.node).attr("data-id",o)},e.fn.mapael.drawLinksCollection=function(t,a,i,n,o){var l={},m={},r={},s={},p={},d={};for(var h in i)r=e.fn.mapael.getElemOptions(a.map.defaultLink,i[h],{}),l="string"==typeof i[h].between[0]?a.plots[i[h].between[0]]:i[h].between[0],m="string"==typeof i[h].between[1]?a.plots[i[h].between[1]]:i[h].between[1],void 0!==l.latitude&&void 0!==l.longitude?s=n(l.latitude,l.longitude):(s.x=l.x,s.y=l.y),void 0!==m.latitude&&void 0!==m.longitude?p=n(m.latitude,m.longitude):(p.x=m.x,p.y=m.y),d[h]=e.fn.mapael.drawLink(h,t,s.x,s.y,p.x,p.y,r,o);return d},e.fn.mapael.drawLink=function(t,a,i,n,o,l,m,r){var s={},p=(i+o)/2,d=(n+l)/2,h=-1/((l-n)/(o-i)),f=d-h*p,c=Math.sqrt((o-i)*(o-i)+(l-n)*(l-n)),g=1+h*h,u=-2*p+2*h*f-2*h*d,v=p*p+f*f-f*d-d*f+d*d-m.factor*c*(m.factor*c),x=u*u-4*g*v,E=0,w=0;return m.factor>0?(E=(-u+Math.sqrt(x))/(2*g),w=h*E+f):(E=(-u-Math.sqrt(x))/(2*g),w=h*E+f),s.mapElem=a.path("m "+i+","+n+" C "+E+","+w+" "+o+","+l+" "+o+","+l).attr(m.attrs),e.fn.mapael.initElem(a,s,m,r,t),s},e.fn.mapael.updateElem=function(t,a,i,n){var o,l,m,r;void 0!==t.value&&(a.value=t.value),a.textElem&&(void 0!==t.text&&void 0!==t.text.content&&t.text.content!=a.textElem.attrs.text&&a.textElem.attr({text:t.text.content}),o=a.mapElem.getBBox(),(t.size||t.width&&t.height)&&("image"==t.type||"svg"==t.type?(m=(t.width-o.width)/2,r=(t.height-o.height)/2):(m=(t.size-o.width)/2,r=(t.size-o.height)/2),o.x-=m,o.x2+=m,o.y-=r,o.y2+=r),l=e.fn.mapael.getTextPosition(o,t.text.position,t.text.margin),l.x==a.textElem.attrs.x&&l.y==a.textElem.attrs.y||(n>0?(a.textElem.attr({"text-anchor":l.textAnchor}),a.textElem.animate({x:l.x,y:l.y},n)):a.textElem.attr({x:l.x,y:l.y,"text-anchor":l.textAnchor})),e.fn.mapael.setHoverOptions(a.textElem,t.text.attrs,t.text.attrsHover),n>0?a.textElem.animate(t.text.attrs,n):a.textElem.attr(t.text.attrs)),e.fn.mapael.setHoverOptions(a.mapElem,t.attrs,t.attrsHover),n>0?a.mapElem.animate(t.attrs,n):a.mapElem.attr(t.attrs),"svg"==t.type&&a.mapElem.transform("m"+t.width/a.mapElem.originalWidth+",0,0,"+t.height/a.mapElem.originalHeight+","+o.x+","+o.y),t.tooltip&&(void 0===a.mapElem.tooltip&&(e.fn.mapael.setTooltip(a.mapElem,i),a.textElem&&e.fn.mapael.setTooltip(a.textElem,i)),a.mapElem.tooltip=t.tooltip,a.textElem&&(a.textElem.tooltip=t.tooltip)),void 0!==t.href&&(void 0===a.mapElem.href&&(e.fn.mapael.setHref(a.mapElem),a.textElem&&e.fn.mapael.setHref(a.textElem)),a.mapElem.href=t.href,a.mapElem.target=t.target,a.textElem&&(a.textElem.href=t.href,a.textElem.target=t.target))},e.fn.mapael.drawPlot=function(t,a,i,n,o){var l={},m={},r=e.fn.mapael.getElemOptions(a.map.defaultPlot,a.plots[t]?a.plots[t]:{},a.legend.plot);return m=void 0!==r.x&&void 0!==r.y?{x:r.x,y:r.y}:i.getCoords(r.latitude,r.longitude),"square"==r.type?l={mapElem:n.rect(m.x-r.size/2,m.y-r.size/2,r.size,r.size).attr(r.attrs)}:"image"==r.type?l={mapElem:n.image(r.url,m.x-r.width/2,m.y-r.height/2,r.width,r.height).attr(r.attrs)}:"svg"==r.type?(l={mapElem:n.path(r.path).attr(r.attrs)},l.mapElem.originalWidth=l.mapElem.getBBox().width,l.mapElem.originalHeight=l.mapElem.getBBox().height,l.mapElem.transform("m"+r.width/l.mapElem.originalWidth+",0,0,"+r.height/l.mapElem.originalHeight+","+(m.x-r.width/2)+","+(m.y-r.height/2))):l={mapElem:n.circle(m.x,m.y,r.size/2).attr(r.attrs)},e.fn.mapael.initElem(n,l,r,o,t),l},e.fn.mapael.setHref=function(t){t.attr({cursor:"pointer"}),e(t.node).bind("click",function(){!e.fn.mapael.panning&&t.href&&window.open(t.href,t.target)})},e.fn.mapael.setTooltip=function(t,a){var i=0,n=a.parent(),o=a.attr("class");e(t.node).on("mouseover",function(l){i=setTimeout(function(){a.attr("class",o),void 0!==t.tooltip&&(void 0!==t.tooltip.content&&a.html(t.tooltip.content).css("display","block"),void 0!==t.tooltip.cssClass&&a.addClass(t.tooltip.cssClass)),a.css({left:Math.min(n.offset().left+n.width()-a.outerWidth()-5,l.pageX+10)-e(window).scrollLeft(),top:Math.min(n.offset().top+n.height()-a.outerHeight()-5,l.pageY+20)-e(window).scrollTop()})},120)}).on("mouseout",function(e){clearTimeout(i),a.css("display","none")}).on("mousemove",function(t){a.css({left:Math.min(n.offset().left+n.width()-a.outerWidth()-5,t.pageX+10)-e(window).scrollLeft(),top:Math.min(n.offset().top+n.height()-a.outerHeight()-5,t.pageY+20)-e(window).scrollTop()})})},e.fn.mapael.setEventHandlers=function(t,a,i,n){for(var o in a.eventHandlers)!function(o){e(i.node).on(o,function(l){!e.fn.mapael.panning&&a.eventHandlers[o](l,t,i,n,a)}),n&&e(n.node).on(o,function(l){!e.fn.mapael.panning&&a.eventHandlers[o](l,t,i,n,a)})}(o)},e.fn.mapael.panning=!1,e.fn.mapael.panningTO=0,e.fn.mapael.initZoom=function(t,a,i,n,o){var l=t.parent(),m=e("<div>").addClass(o.zoomInCssClass).html("+"),r=e("<div>").addClass(o.zoomOutCssClass).html("&#x2212;"),s=!1,p=0,d=0;l.data("zoomLevel",0).data({panX:0,panY:0}),t.append(m).append(r),m.on("click",function(){l.trigger("zoom",{level:l.data("zoomLevel")+1})}),r.on("click",function(){l.trigger("zoom",{level:l.data("zoomLevel")-1})}),e("body").on("mouseup"+(o.touch?" touchend":""),function(t){s=!1,setTimeout(function(){e.fn.mapael.panning=!1},50)}),t.on("mousedown"+(o.touch?" touchstart":""),function(e){void 0!==e.pageX?(s=!0,p=e.pageX,d=e.pageY):1===e.originalEvent.touches.length&&(s=!0,p=e.originalEvent.touches[0].pageX,d=e.originalEvent.touches[0].pageY)}).on("mousemove"+(o.touch?" touchmove":""),function(m){var r=l.data("zoomLevel"),h=0,f=0;if(void 0!==m.pageX?(h=m.pageX,f=m.pageY):1===m.originalEvent.touches.length?(h=m.originalEvent.touches[0].pageX,f=m.originalEvent.touches[0].pageY):s=!1,s&&0!=r){var c=(p-h)/(1+r*o.step)*(i/a.width),g=(d-f)/(1+r*o.step)*(n/a.height),u=Math.min(Math.max(0,a._viewBox[0]+c),i-a._viewBox[2]),v=Math.min(Math.max(0,a._viewBox[1]+g),n-a._viewBox[3]);return(Math.abs(c)>5||Math.abs(g)>5)&&(l.data({panX:u,panY:v}),a.setViewBox(u,v,a._viewBox[2],a._viewBox[3]),clearTimeout(e.fn.mapael.panningTO),e.fn.mapael.panningTO=setTimeout(function(){t.trigger("afterPanning",{x1:u,y1:v,x2:u+a._viewBox[2],y2:v+a._viewBox[3]})},150),p=h,d=f,e.fn.mapael.panning=!0),!1}})},e.fn.mapael.drawLegend=function(t,a,i,n,o,l,m){var r={},s={},p=0,d=0,h={},f={},c={},g={},u=0,v=0,x=0,E=0,w=[],y=0;if(t.slices&&t.display){for(r=e("."+t.cssClass,a).empty(),s=new Raphael(r.get(0)),d=p=0,t.title&&(h=s.text(t.marginLeftTitle,0,t.title).attr(t.titleAttrs),h.attr({y:.5*h.getBBox().height}),p=t.marginLeftTitle+h.getBBox().width,d+=t.marginBottomTitle+h.getBBox().height),u=0,y=t.slices.length;u<y;++u)void 0===t.slices[u].legendSpecificAttrs&&(t.slices[u].legendSpecificAttrs={}),w[u]=e.extend({},"plot"==n?i.map.defaultPlot.attrs:i.map.defaultArea.attrs,t.slices[u].attrs,t.slices[u].legendSpecificAttrs),"area"==n?(void 0===w[u].width&&(w[u].width=30),void 0===w[u].height&&(w[u].height=20)):"square"==t.slices[u].type?(void 0===w[u].width&&(w[u].width=t.slices[u].size),void 0===w[u].height&&(w[u].height=t.slices[u].size)):"image"==t.slices[u].type||"svg"==t.slices[u].type?(void 0===w[u].width&&(w[u].width=t.slices[u].width),void 0===w[u].height&&(w[u].height=t.slices[u].height)):void 0===w[u].r&&(w[u].r=t.slices[u].size/2),E="plot"!=n||void 0!==t.slices[u].type&&"circle"!=t.slices[u].type?Math.max(E,t.marginBottomTitle+h.getBBox().height+l*w[u].height/2):Math.max(E,t.marginBottomTitle+h.getBBox().height+l*w[u].r);for("horizontal"==t.mode&&(p=t.marginLeft),u=0,y=t.slices.length;u<y;++u)void 0!==t.slices[u].display&&1!=t.slices[u].display||("area"==n?("horizontal"==t.mode?(v=p+t.marginLeft,x=E-.5*l*w[u].height):(v=t.marginLeft,x=d),f=s.rect(v,x,l*w[u].width,l*w[u].height)):"square"==t.slices[u].type?("horizontal"==t.mode?(v=p+t.marginLeft,x=E-.5*l*w[u].height):(v=t.marginLeft,x=d),f=s.rect(v,x,l*w[u].width,l*w[u].height)):"image"==t.slices[u].type||"svg"==t.slices[u].type?("horizontal"==t.mode?(v=p+t.marginLeft,x=E-.5*l*w[u].height):(v=t.marginLeft,x=d),"image"==t.slices[u].type?f=s.image(t.slices[u].url,v,x,l*w[u].width,l*w[u].height):(f=s.path(t.slices[u].path),f.transform("m"+l*t.slices[u].width/f.getBBox().width+",0,0,"+l*t.slices[u].height/f.getBBox().height+","+v+","+x))):("horizontal"==t.mode?(v=p+t.marginLeft+l*w[u].r,x=E):(v=t.marginLeft+l*w[u].r,x=d+l*w[u].r),f=s.circle(v,x,l*w[u].r)),delete w[u].width,delete w[u].height,delete w[u].r,f.attr(w[u]),c=f.getBBox(),"horizontal"==t.mode?(v=p+t.marginLeft+c.width+t.marginLeftLabel,x=E):(v=t.marginLeft+c.width+t.marginLeftLabel,x=d+c.height/2),g=s.text(v,x,t.slices[u].label).attr(t.labelAttrs),"horizontal"==t.mode?(p+=t.marginLeft+c.width+t.marginLeftLabel+g.getBBox().width,d="image"==t.slices[u].type||"area"==n?Math.max(d,t.marginBottom+h.getBBox().height+c.height):Math.max(d,t.marginBottomTitle+t.marginBottom+h.getBBox().height+c.height)):(p=Math.max(p,t.marginLeft+c.width+t.marginLeftLabel+g.getBBox().width),d+=t.marginBottom+c.height),e(f.node).attr({"data-type":"elem","data-index":u,"data-hidden":0}),e(g.node).attr({"data-type":"label","data-index":u,"data-hidden":0}),t.hideElemsOnClick.enabled&&(g.attr({cursor:"pointer"}),f.attr({cursor:"pointer"}),e.fn.mapael.setHoverOptions(f,w[u],w[u]),e.fn.mapael.setHoverOptions(g,t.labelAttrs,t.labelAttrsHover),e.fn.mapael.setHover(s,f,g),e.fn.mapael.handleClickOnLegendElem(a,t,t.slices[u],g,f,o,m)));return"SVG"!=Raphael.type&&t.VMLWidth&&(p=t.VMLWidth),s.setSize(p,d),s}},e.fn.mapael.handleClickOnLegendElem=function(t,a,i,n,o,l,m){var r=function(r,s){var p=0,d=e(n.node).attr("data-hidden"),h=0==d?{"data-hidden":1}:{"data-hidden":0};0==d?n.animate({opacity:.5},300):n.animate({opacity:1},300);for(var f in l)p=e.isArray(l[f].value)?l[f].value[m]:l[f].value,(void 0!==i.sliceValue&&p==i.sliceValue||void 0===i.sliceValue&&(void 0===i.min||p>=i.min)&&(void 0===i.max||p<i.max))&&function(e){0==d?(l[e].mapElem.animate({opacity:a.hideElemsOnClick.opacity},300,"linear",function(){0==a.hideElemsOnClick.opacity&&l[e].mapElem.hide()}),l[e].textElem&&l[e].textElem.animate({opacity:a.hideElemsOnClick.opacity},300,"linear",function(){0==a.hideElemsOnClick.opacity&&l[e].textElem.hide()})):(0==a.hideElemsOnClick.opacity&&(l[e].mapElem.show(),l[e].textElem&&l[e].textElem.show()),l[e].mapElem.animate({opacity:void 0!==l[e].mapElem.originalAttrs.opacity?l[e].mapElem.originalAttrs.opacity:1},300),l[e].textElem&&l[e].textElem.animate({opacity:void 0!==l[e].textElem.originalAttrs.opacity?l[e].textElem.originalAttrs.opacity:1},300))}(f);e(o.node).attr(h),e(n.node).attr(h),void 0!==s&&!0!==s||void 0===a.exclusive||!0!==a.exclusive||e("[data-type='elem'][data-hidden=0]",t).each(function(){e(this).attr("data-index")!==e(o.node).attr("data-index")&&e(this).trigger("click",!1)})};e(n.node).on("click",r),e(o.node).on("click",r),void 0!==i.clicked&&!0===i.clicked&&e(o.node).trigger("click",!1)},e.fn.mapael.createLegends=function(t,a,i,n,o){var l=[];if(e.isArray(a.legend[i]))for(var m=0;m<a.legend[i].length;++m)l.push(e.fn.mapael.drawLegend(a.legend[i][m],t,a,i,n,o,m));else l.push(e.fn.mapael.drawLegend(a.legend[i],t,a,i,n,o));return l},e.fn.mapael.setHoverOptions=function(t,a,i){"SVG"!=Raphael.type&&delete i.transform,t.attrsHover=i,t.attrsHover.transform?t.originalAttrs=e.extend({transform:"s1"},a):t.originalAttrs=a},e.fn.mapael.setHover=function(t,a,i){var n={},o={},l=0,m=function(){l=setTimeout(function(){e.fn.mapael.elemHover(t,a,i)},120)},r=function(){clearTimeout(l),e.fn.mapael.elemOut(t,a,i)};n=e(a.node),n.on("mouseover",m),n.on("mouseout",r),i&&(o=e(i.node),o.on("mouseover",m),e(i.node).on("mouseout",r))},e.fn.mapael.elemHover=function(e,t,a){t.animate(t.attrsHover,t.attrsHover.animDuration),a&&a.animate(a.attrsHover,a.attrsHover.animDuration),e.safari()},e.fn.mapael.elemOut=function(e,t,a){t.animate(t.originalAttrs,t.attrsHover.animDuration),a&&a.animate(a.originalAttrs,a.attrsHover.animDuration),e.safari()},e.fn.mapael.getElemOptions=function(t,a,i){var n=e.extend(!0,{},t,a);if(void 0!==n.value)if(e.isArray(i))for(var o=0,l=i.length;o<l;++o)n=e.extend(!0,{},n,e.fn.mapael.getLegendSlice(n.value[o],i[o]));else n=e.extend(!0,{},n,e.fn.mapael.getLegendSlice(n.value,i));return n},e.fn.mapael.getTextPosition=function(e,t,a){var i=0,n=0,o="";switch(t){case"bottom":i=(e.x+e.x2)/2,n=e.y2+a,o="middle";break;case"top":i=(e.x+e.x2)/2,n=e.y-a,o="middle";break;case"left":i=e.x-a,n=(e.y+e.y2)/2,o="end";break;case"right":i=e.x2+a,n=(e.y+e.y2)/2,o="start";break;default:i=(e.x+e.x2)/2,n=(e.y+e.y2)/2,o="middle"}return{x:i,y:n,textAnchor:o}},e.fn.mapael.getLegendSlice=function(e,t){for(var a=0,i=t.slices.length;a<i;++a)if(void 0!==t.slices[a].sliceValue&&e==t.slices[a].sliceValue||void 0===t.slices[a].sliceValue&&(void 0===t.slices[a].min||e>=t.slices[a].min)&&(void 0===t.slices[a].max||e<t.slices[a].max))return t.slices[a];return{}},e.fn.mapael.animationIntervalID=null,e.fn.mapael.animateViewBox=function(t,a,i,n,o,l,m,r){var s=a._viewBox?a._viewBox[0]:0,p=i-s,d=a._viewBox?a._viewBox[1]:0,h=n-d,f=a._viewBox?a._viewBox[2]:a.width,c=o-f,g=a._viewBox?a._viewBox[3]:a.height,u=l-g,r=r||"linear",v=m/25,x=0,E=Raphael.easing_formulas[r];clearInterval(e.fn.mapael.animationIntervalID),e.fn.mapael.animationIntervalID=setInterval(function(){var m=x/v;a.setViewBox(s+p*E(m),d+h*E(m),f+c*E(m),g+u*E(m),!1),x++>=v&&(clearInterval(e.fn.mapael.animationIntervalID),clearTimeout(e.fn.mapael.zoomTO),e.fn.mapael.zoomTO=setTimeout(function(){t.trigger("afterZoom",{x1:i,y1:n,x2:i+o,y2:n+l})},150))},25)},e.fn.mapael.defaultOptions={map:{cssClass:"map",tooltip:{cssClass:"mapTooltip",target:null},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},text:{position:"right",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},defaultLink:{factor:.5,attrs:{stroke:"#0088db","stroke-width":2},attrsHover:{animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},zoom:{enabled:!1,maxLevel:10,step:.25,zoomInCssClass:"zoomIn",zoomOutCssClass:"zoomOut",mousewheel:!0,touch:!0,animDuration:200,animEasing:"linear"}},legend:{area:[],plot:[]},areas:{},plots:{},links:{}},e.fn.mapael.legendDefaultOptions={area:{cssClass:"areaLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2},slices:[],mode:"vertical"},plot:{cssClass:"plotLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2},slices:[],mode:"vertical"}}}(jQuery);